{"version":3,"file":"reactivity.esm-bundler.js","sources":["../../shared/src/index.ts","../src/basehandle.ts","../src/reactive.ts"],"sourcesContent":["export const isObject = value => typeof value === 'object' && value !== null\nexport const extend = Object.assign","import { isObject, extend } from \"@vue/shared/src\"\nimport { readonly, reactive } from \"./reactive\"\n\nconst get = createGetter(false, false)\nconst shallowReactiveGetter = createGetter(false, true)\nconst readonlyGetter = createGetter(true, false)\nconst shallowReadonlyGetter = createGetter(true, true)\nconst set = createSetter()\nconst shallowReactiveSet = createSetter(true)\nconst readonlySetter = {\n  set: () => {\n    console.warn('set key fail')\n  }\n}\nexport const mutableHandles = {\n  get,\n  set\n}\nexport const shallowReactiveHandles = {\n  get: shallowReactiveGetter,\n  set: shallowReactiveSet\n}\nexport const readonlyHandles = extend({\n  get: readonlyGetter,\n}, readonlySetter)\nexport const shallowReadonlyHandles = extend({\n  get: shallowReadonlyGetter,\n  set\n}, readonlySetter)\n// 柯里化\n/**\n * \n * @param isReadonly 是否只读，默认不是只读\n * @param shallow 是否浅层代理，默认不是浅层代理\n */\nexport function createGetter(isReadonly = false, shallow = false) {\n  return function get(target, key) {\n    const res = Reflect.get(target, key)\n    if (!isReadonly) {\n\n    }\n    if (shallow) {\n      // 是否为浅层代理\n      return res\n    }\n    if (isObject(res)) {\n      // 如果读取到的值还是一个对象类型的话，要进行深度代理\n      // 递归，相比较vue2代理，vue3代理是当我们取值时才会进行深度代理(懒代理)\n      return isReadonly ? readonly(res) : reactive(res)\n    }\n    return res\n  }\n}\n/**\n * \n * @param shallow 是否为浅层代理,默认不是浅层代理\n */\nexport function createSetter(shallow = false) {\n  return function set(target, key, value) {\n    const res = Reflect.set(target, key, value)\n\n    return res\n  }\n}","import {\n  mutableHandles,\n  shallowReactiveHandles,\n  readonlyHandles,\n  shallowReadonlyHandles\n} from './basehandle'\nimport { isObject } from '@vue/shared'\n// 深度代理\nexport const reactive = (target) => {\n  return createProxy(target, false, mutableHandles)\n}\n// 浅层代理\nexport const shallowReactive = (target) => {\n  return createProxy(target, false, shallowReactiveHandles)\n}\n// 深度代理/只读\nexport const readonly = (target) => {\n  return createProxy(target, true, readonlyHandles)\n}\n// 浅层代理/浅层只读\nexport const shallowReadonly = (target) => {\n  return createProxy(target, true, shallowReadonlyHandles)\n}\n\n/**\n * \n * @param target 要被代理的目标对象\n * @param isReadonly 是否只读\n * @param basehandle get/set\n */\nconst reativeMap = new WeakMap()\nconst readonlyMap = new WeakMap()\nexport function createProxy(target, isReadonly, basehandle) {\n  // 如果目标不是对象，就不能被代理\n  if (!isObject(target)) return target\n  // 缓存代理的结果,不要被多次代理\n  // 根据是否只读决定不同的存储空间\n  const proxyMap = isReadonly ? readonlyMap : reativeMap\n  if (proxyMap.get(target)) {\n    // 返回上一次存储的代理结果即可\n    return proxyMap.get(target)\n  }\n  const proxy = new Proxy(target, basehandle)\n  // 存储到容器中\n  proxyMap.set(target, proxy)\n  return proxy\n}"],"names":[],"mappings":"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"}