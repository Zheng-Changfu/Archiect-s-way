{"version":3,"file":"reactivity.global.js","sources":["../../shared/src/index.ts","../src/basehandle.ts","../src/reactive.ts"],"sourcesContent":["export const isObject = value => typeof value === 'object' && value !== null\nexport const extend = Object.assign","import { isObject, extend } from \"@vue/shared/src\"\nimport { readonly, reactive } from \"./reactive\"\n\nconst get = createGetter(false, false)\nconst shallowReactiveGetter = createGetter(false, true)\nconst readonlyGetter = createGetter(true, false)\nconst shallowReadonlyGetter = createGetter(true, true)\nconst set = createSetter()\nconst shallowReactiveSet = createSetter(true)\nconst readonlySetter = {\n  set: () => {\n    console.warn('set key fail')\n  }\n}\nexport const mutableHandles = {\n  get,\n  set\n}\nexport const shallowReactiveHandles = {\n  get: shallowReactiveGetter,\n  set: shallowReactiveSet\n}\nexport const readonlyHandles = extend({\n  get: readonlyGetter,\n}, readonlySetter)\nexport const shallowReadonlyHandles = extend({\n  get: shallowReadonlyGetter,\n  set\n}, readonlySetter)\n// 柯里化\n/**\n * \n * @param isReadonly 是否只读，默认不是只读\n * @param shallow 是否浅层代理，默认不是浅层代理\n */\nexport function createGetter(isReadonly = false, shallow = false) {\n  return function get(target, key) {\n    const res = Reflect.get(target, key)\n    if (!isReadonly) {\n\n    }\n    if (shallow) {\n      // 是否为浅层代理\n      return res\n    }\n    if (isObject(res)) {\n      // 如果读取到的值还是一个对象类型的话，要进行深度代理\n      // 递归，相比较vue2代理，vue3代理是当我们取值时才会进行深度代理(懒代理)\n      return isReadonly ? readonly(res) : reactive(res)\n    }\n    return res\n  }\n}\n/**\n * \n * @param shallow 是否为浅层代理,默认不是浅层代理\n */\nexport function createSetter(shallow = false) {\n  return function set(target, key, value) {\n    const res = Reflect.set(target, key, value)\n\n    return res\n  }\n}","import {\n  mutableHandles,\n  shallowReactiveHandles,\n  readonlyHandles,\n  shallowReadonlyHandles\n} from './basehandle'\nimport { isObject } from '@vue/shared'\n// 深度代理\nexport const reactive = (target) => {\n  return createProxy(target, false, mutableHandles)\n}\n// 浅层代理\nexport const shallowReactive = (target) => {\n  return createProxy(target, false, shallowReactiveHandles)\n}\n// 深度代理/只读\nexport const readonly = (target) => {\n  return createProxy(target, true, readonlyHandles)\n}\n// 浅层代理/浅层只读\nexport const shallowReadonly = (target) => {\n  return createProxy(target, true, shallowReadonlyHandles)\n}\n\n/**\n * \n * @param target 要被代理的目标对象\n * @param isReadonly 是否只读\n * @param basehandle get/set\n */\nconst reativeMap = new WeakMap()\nconst readonlyMap = new WeakMap()\nexport function createProxy(target, isReadonly, basehandle) {\n  // 如果目标不是对象，就不能被代理\n  if (!isObject(target)) return target\n  // 缓存代理的结果,不要被多次代理\n  // 根据是否只读决定不同的存储空间\n  const proxyMap = isReadonly ? readonlyMap : reativeMap\n  if (proxyMap.get(target)) {\n    // 返回上一次存储的代理结果即可\n    return proxyMap.get(target)\n  }\n  const proxy = new Proxy(target, basehandle)\n  // 存储到容器中\n  proxyMap.set(target, proxy)\n  return proxy\n}"],"names":[],"mappings":"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"}