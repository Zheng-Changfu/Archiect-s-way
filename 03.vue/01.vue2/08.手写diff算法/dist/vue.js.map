{"version":3,"file":"vue.js","sources":["../lib/utils.js","../lib/observe/array.js","../lib/observe/dep.js","../lib/observe/index.js","../lib/observe/scheduler.js","../lib/observe/watcher.js","../lib/state.js","../lib/vDom/patch.js","../lib/lifecycle.js","../lib/compile/parser.js","../lib/compile/generate.js","../lib/compile/index.js","../lib/init.js","../lib/vDom/index.js","../lib/render.js","../lib/global-api/index.js","../lib/index.js"],"sourcesContent":["export const isFunction = val => {\r\n  return typeof val === 'function'\r\n}\r\nexport const isObject = val => {\r\n  return typeof val === 'object' && val !== null\r\n}\r\nexport const isArray = val => {\r\n  return Array.isArray(val)\r\n}\r\n\r\nexport let compileTemplate = {\r\n  // 匹配标签名\r\n  tag: `[a-zA-Z][-0-9a-zA-Z]*`,\r\n  // 匹配标签开始\r\n  startTag: html => {\r\n    const reg = new RegExp(`^<(${compileTemplate.tag})`)\r\n    return html.match(reg)\r\n  },\r\n  // 匹配标签属性\r\n  tagAttributes: text => {\r\n    // 标签属性有3种,a=b a='b' a=\"b\",前后可能有多个空格\r\n    const reg = /\\s*([^=\\s'\"\\/<>]+)\\s*=\\s*(?:\"([^\"]+)\")|(?:'([^']+)')|([^\\s\"'=<>`]+)?/\r\n    return text.match(reg)\r\n  },\r\n  // 匹配标签结束\r\n  tagClose: text => {\r\n    // 可能为自结束标签，可以为> ,/>\r\n    const reg = /^\\s*(\\/?)>/\r\n    return text.match(reg)\r\n  },\r\n  // 匹配结束标签\r\n  closeTag: text => {\r\n    // </div >\r\n    const reg = new RegExp(`^<\\/(${compileTemplate.tag})*>`)\r\n    return text.match(reg)\r\n  },\r\n  // 匹配插值语法\r\n  qn: (text, count = 1) => {\r\n    const reg = /\\{\\{([\\s\\S]*?)\\}\\}/g\r\n    return count ? text.match(reg) : reg\r\n  }\r\n}\r\n\r\n\r\nlet callbacks = []\r\nlet watting = false\r\nexport function nextTick (cb) {\r\n  // 按照正常来说，肯定是内部源码调用的nextTick先进来，然后再是函数，因为代码是一行行执行的\r\n  callbacks.push(cb)\r\n  // 也要做防抖，不能每次调用nextTick都循环一次\r\n  if (!watting) {\r\n    watting = true\r\n    Promise.resolve().then(flushCallbacks)\r\n  }\r\n}\r\nfunction flushCallbacks () {\r\n  for (let i = 0; i < callbacks.length; i++) {\r\n    const cb = callbacks[i]\r\n    cb()\r\n  }\r\n  callbacks = []\r\n  watting = false\r\n}\r\n\r\nconst hooks = [\r\n  'beforeCreate',\r\n  'created',\r\n  'beforeMount',\r\n  'mounted',\r\n  'beforeUpdate',\r\n  'updated',\r\n  'beforeDestroy',\r\n  'destroyed'\r\n]\r\nconst stracts = {}\r\nfor (let i = 0; i < hooks.length; i++) {\r\n  const hook = hooks[i]\r\n  stracts[hook] = mergeHook\r\n}\r\n\r\n// 组件的合并策略\r\n/**\r\n * 会按照原型链的方式进行合并，如果自身上找不到，在找原型上的(Vue.component)\r\n */\r\nstracts.components = function (parentValue, childValue) {\r\n  // options.__proto__ = parentValue\r\n  let options = Object.create(parentValue)\r\n  if (childValue) {\r\n    for (let key in childValue) {\r\n      options[key] = childValue[key]\r\n    }\r\n  }\r\n  return options\r\n}\r\n\r\n// 生命周期钩子的合并策略\r\nfunction mergeHook (parentValue, childValue) {\r\n  if (childValue) {\r\n    if (parentValue) {\r\n      return parentValue.concat(childValue); // 后续\r\n    } else {\r\n      return [childValue]; // 第一次\r\n    }\r\n  } else {\r\n    return parentValue\r\n  }\r\n}\r\n\r\n\r\nexport function mergeOptions (parent, child) {\r\n  let obj = {}\r\n  for (let key in parent) {\r\n    mergeField(key)\r\n  }\r\n  for (let key in child) {\r\n    mergeField(key)\r\n  }\r\n  function mergeField (key) {\r\n    /**\r\n     * \r\n     * 情况:\r\n     *  parent : {a:1} child : {a:2} ==> {a:2}\r\n     *  parent : {a:1,data:{c:1}} child : {b:2,data:{d:2}} ==> {a:1,data:{c:1,d:2},b:2}\r\n     *  parent : {}  child : {beforeCreated:fn} ==> {beforeCreated:[fn]}\r\n     *  parent : {beforeCreated:[fn]} child : {beforeCreated:fn} ==> {beforeCreated:[fn1,fn2]}\r\n     * **/\r\n    const parentValue = parent[key]\r\n    const childValue = child[key]\r\n    // 生命周期策略\r\n    if (stracts[key]) {\r\n      obj[key] = stracts[key](parentValue, childValue)\r\n    } else {\r\n      // 如果value是对象，暂时不考虑递归合并，浅拷贝\r\n      // 如果value不是对象，那么以child数据为准\r\n      if (isObject(parentValue) && isObject(childValue)) {\r\n        obj[key] = { ...parentValue, ...childValue }\r\n      } else {\r\n        // 如果子没值，就取父的值\r\n        obj[key] = childValue || parentValue\r\n      }\r\n    }\r\n  }\r\n  return obj\r\n}\r\n\r\nexport function isReverseTag (tag) {\r\n  // 这里我们意思一下就行\r\n  const str = 'a,b,i,img,p,ul,li,div,button'\r\n  return str.includes(tag)\r\n}","const oldArrayProto = Array.prototype\r\nexport const arrayMethods = Object.create(oldArrayProto)\r\nlet methods = [\r\n  'shift',\r\n  'unshift',\r\n  'sort',\r\n  'pop',\r\n  'splice',\r\n  'push',\r\n  'reverse'\r\n]\r\n\r\nmethods.forEach(method => {\r\n  // 对数组方法进行重写\r\n  arrayMethods[method] = function (...args) {\r\n    oldArrayProto[method].call(this, ...args)\r\n    let ob = this.__ob__ // 拿到Observe实例\r\n\r\n    // 如果方法是新增属性的，那么我们要对新增的属性再次进行响应式处理\r\n    let inserted\r\n    switch (method) {\r\n      case 'push':\r\n      case 'unshift':\r\n        inserted = args\r\n        break;\r\n      case 'splice':\r\n        inserted = args.slice(2)\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    if (inserted) {\r\n      // 说明调用了push/unshift/splice等方法\r\n      // 将新增的数据定义成响应式\r\n      ob.observeArray(inserted)\r\n    }\r\n    // 调用了数组的变异方法，就要通知watcher进行更新\r\n    ob.dep.notify()\r\n  }\r\n})\r\n","let id = 0\r\nclass Dep {\r\n  constructor() {\r\n    this.id = id++\r\n    this.subs = []\r\n  }\r\n  depend () {\r\n    if (Dep.target) {\r\n      // Dep.target就是watcher\r\n      Dep.target.addDeps(this) // this是当前实例dep\r\n    }\r\n  }\r\n  addSubs (watcher) {\r\n    this.subs.push(watcher)\r\n  }\r\n  notify () {\r\n    this.subs.forEach(watcher => watcher.update())\r\n  }\r\n}\r\n\r\nDep.target = null\r\nlet stack = []\r\nexport function pushTarget (watcher) {\r\n  Dep.target = watcher\r\n  stack.push(watcher)\r\n}\r\nexport function popTarget () {\r\n  // Dep.target = null\r\n  stack.pop()\r\n  Dep.target = stack[stack.length - 1]\r\n}\r\nexport default Dep\r\n","import { isArray, isObject } from \"../utils\"\r\nimport { arrayMethods } from './array'\r\nimport Dep from \"./dep\"\r\nclass Observe {\r\n  constructor(data) {\r\n    // 只要类型是对象的都分配dep属性\r\n    this.dep = new Dep()\r\n    // 响应式属性里都会有一个__ob__属性\r\n    // data.__ob__ = this // 这么写会导致爆栈，因为一直在调用walk方法，然后一直在循环调用new Observe\r\n    Object.defineProperty(data, '__ob__', {\r\n      value: this,\r\n      enumerable: false // 不可被枚举(遍历)\r\n    })\r\n    // 如果数据为一个数组，那么也会进来，此时我们要改写数组中的方法\r\n    if (isArray(data)) {\r\n      // 改写数组的方法\r\n      data.__proto__ = arrayMethods\r\n      this.observeArray(data) // 对数组中是对象的定义成响应式\r\n    } else {\r\n      this.walk(data)\r\n    }\r\n  }\r\n  observeArray (data) {\r\n    data.forEach(item => {\r\n      observe(item)\r\n    })\r\n  }\r\n  walk (data) {\r\n    Object.keys(data).forEach(key => {\r\n      const value = data[key]\r\n      defineReactive(data, key, value)\r\n    })\r\n  }\r\n}\r\n\r\nfunction dependArray (value) {\r\n  for (let i = 0; i < value.length; i++) {\r\n    let current = value[i] // current就是嵌套的数组\r\n    current.__ob__ && current.__ob__.dep.depend()\r\n    if (Array.isArray(current)) {\r\n      dependArray(current)\r\n    }\r\n  }\r\n}\r\nfunction defineReactive (data, key, value) {\r\n  // 如果对象嵌套对象，继续进行递归观测\r\n  let childOb = observe(value)\r\n  // 每个属性都有自己的dep\r\n  let dep = new Dep()\r\n  Object.defineProperty(data, key, {\r\n    get () {\r\n      // 先执行的是pushTarget方法存放了watcher，然后挂载组件，模板中使用了vm上的属性，会触发get，进来\r\n      if (Dep.target) {\r\n        dep.depend() // 存放watcher\r\n        // console.log(value)\r\n        // console.log(childOb)\r\n        if (childOb) {\r\n          // 说明数组或者对象(引用类型)中也需要收集watcher\r\n          childOb.dep.depend()\r\n          // 数组嵌套数组,也要考虑，因为数组嵌套数组，也会生成一个新的dep，新的dep也要去收集Watcher\r\n          if (Array.isArray(value)) {\r\n            dependArray(value)\r\n          }\r\n        }\r\n      }\r\n      return value\r\n    },\r\n    set (newVal) {\r\n      if (value !== newVal) {\r\n        // 如果用户新赋值一个对象，那么新对象也要进行观测\r\n        observe(newVal)\r\n        value = newVal\r\n        // 通知watcher去更新\r\n        dep.notify()\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\nexport function observe (data) {\r\n  if (!isObject(data)) return\r\n  if (data.__ob__) return data.__ob__\r\n  return new Observe(data)\r\n}","import { nextTick } from '../utils'\r\nlet queue = []\r\nlet obj = {}\r\nlet pending = false\r\nexport function queueWatcher (watcher) {\r\n  const id = watcher.id\r\n  if (!obj[id]) {\r\n    queue.push(watcher)\r\n    obj[id] = true\r\n    if (!pending) {\r\n      pending = true\r\n      nextTick(flushSchedulerQueue)\r\n    }\r\n  }\r\n}\r\n\r\nfunction flushSchedulerQueue () {\r\n  for (let i = 0; i < queue.length; i++) {\r\n    queue[i].run()\r\n  }\r\n  queue = []\r\n  obj = {}\r\n  pending = false\r\n}","import { pushTarget, popTarget } from \"./dep\"\r\nimport { queueWatcher } from './scheduler'\r\nlet id = 0\r\nclass Watcher {\r\n  /**\r\n   * \r\n   * @param {*} vm Vue实例\r\n   * @param {*} updateFnOrExpr 更新的方法或者表达式\r\n   * @param {*} cb 自定义回调函数\r\n   * @param {*} options 其他选项配置\r\n   */\r\n  constructor(vm, updateFnOrExpr, cb, options = {}) {\r\n    this.vm = vm\r\n    this.id = id++ // 每个watcher都是单独的，用id来区分一下\r\n    this.user = !!options.user // 区分是否为用户Watcher\r\n    this.lazy = !!options.lazy // 区分是否为计算Watcher，默认不执行\r\n    this.dirty = !!options.lazy // 区分是否需要调用计算属性中的get回调\r\n    this.cb = cb\r\n    this.options = options\r\n    this.deps = []\r\n    this.depsId = new Set()\r\n    if (typeof updateFnOrExpr === 'string') {\r\n      // 表示为一个表达式，因为等下要调用this.get，get方法中会调用updateFnOrExpr，所以我们这里重写updateFnOrExpr\r\n      // 等下调用this.get会存储用户Watcher,然后调用this.updateFnOrExpr会触发我们下面的函数，然后会触发响应式中的get方法\r\n      // 会去收集用户Watcher，然后返回vm.name的值\r\n      // 当我们去改变name值的时候，会通知Watcher更新，我们收集新值和老值然后去调用用户回调即可\r\n      this.updateFnOrExpr = function () {\r\n        // return vm[updateFnOrExpr]\r\n\r\n        // 外界可能传入这种格式,'hobby.a'(),我们需要取到a的值,就不能按照上面那种写法了\r\n        let obj = vm\r\n        const arr = updateFnOrExpr.split('.')\r\n        for (let i = 0; i < arr.length; i++) {\r\n          obj = obj[arr[i]]\r\n        }\r\n        return obj\r\n      }\r\n    } else {\r\n      // 表示为渲染Watcher\r\n      this.updateFnOrExpr = updateFnOrExpr\r\n    }\r\n\r\n    this.value = this.lazy ? undefined : this.get()\r\n  }\r\n  get () {\r\n    pushTarget(this)\r\n    // 这个方法会触发Object.defineProperty中的get，会去vm上面取值,第一次的值就是最早的值，第二次的值就是最新的值\r\n    const value = this.updateFnOrExpr()\r\n    popTarget() // 在外面用vm上的属性是不需要收集Watcher的\r\n    return value\r\n  }\r\n  // 存放dep,如果模板中使用了2次 {{ name }} {{ name }},他们其实用的是一个id，那么我们就不需要存放到数组中，需要进行去重\r\n  addDeps (dep) {\r\n    const id = dep.id\r\n    if (!this.depsId.has(id)) {\r\n      this.depsId.add(id)\r\n      this.deps.push(dep)\r\n      // 调用dep的addSubs方法来存放watcher\r\n      dep.addSubs(this)\r\n    }\r\n  }\r\n  // Vue中是异步更新的，主要是做一个缓存等待\r\n  // 如果watcher的id都是一样，那么要进行去重，而且只需要更新一次即可 (防抖) ，同一个页面多个dep公共一个watcher\r\n  // 所以Vue内部更新原理是: 去重 + 防抖\r\n  update () {\r\n    if (this.lazy) {\r\n      this.dirty = true\r\n    } else {\r\n      queueWatcher(this)\r\n    }\r\n  }\r\n  run () {\r\n    // 更新\r\n    const newVal = this.get()\r\n    if (this.user) {\r\n      const oldValue = this.value\r\n      // 下一次的老值是这一次的新值\r\n      this.value = newVal\r\n      // 表示是用户watcher\r\n      this.cb.call(this.vm, newVal, oldValue)\r\n    }\r\n  }\r\n  // 计算属性的缓存\r\n  computedFn () {\r\n    this.dirty = false\r\n    // get函数的返回值就是外面用户在get函数中return的值\r\n    this.value = this.get()\r\n  }\r\n  depend () {\r\n    // 因为我们在计算属性中取了值，所以会去收集dep\r\n    let i = this.deps.length\r\n    while (i--) {\r\n      const dep = this.deps[i]\r\n      dep.depend()\r\n    }\r\n  }\r\n}\r\n\r\nexport default Watcher","import { observe } from './observe/index'\r\nimport { isFunction } from './utils'\r\nimport Watcher from './observe/watcher'\r\nimport Dep from './observe/dep'\r\nexport function stateMixin (Vue) {\r\n  Vue.prototype.$watch = function (key, handler, options = {}) {\r\n    const vm = this\r\n    options.user = true // 表示是一个用户Watcher\r\n    new Watcher(vm, key, handler, options)\r\n  }\r\n}\r\nexport function initState (vm) {\r\n  if (vm.$options.data) {\r\n    initData(vm)\r\n  }\r\n  if (vm.$options.watch) {\r\n    initWatch(vm)\r\n  }\r\n  if (vm.$options.computed) {\r\n    initComputed(vm)\r\n  }\r\n}\r\nfunction proxy (vm, source, key) {\r\n  Object.defineProperty(vm, key, {\r\n    get () {\r\n      return vm[source][key]\r\n    },\r\n    set (newVal) {\r\n      vm[source][key] = newVal\r\n    }\r\n  })\r\n}\r\nfunction initData (vm) {\r\n  let data = vm.$options.data\r\n  data = vm._data = isFunction(data) ? data.call(vm) : data\r\n  // 所有的数据现在都在_data中，那么我们做一层数据代理，外界访问vm.xxx的时候我们去vm._data中读取xxx\r\n  for (let key in data) {\r\n    proxy(vm, '_data', key)\r\n  }\r\n  observe(data)\r\n}\r\nfunction initWatch (vm) {\r\n  const watch = vm.$options.watch\r\n  Object.keys(watch).forEach(key => {\r\n    const handler = watch[key]\r\n    // handler可能是数组，可能是字符串，可能是对象,可能是函数\r\n    // 暂时没实现methods和对象,所以先不考虑这两种\r\n    // 那就先考虑数组和函数的情况\r\n    if (Array.isArray(handler)) {\r\n      for (let i = 0; i < handler.length; i++) {\r\n        const fn = handler[i]\r\n        // 没一个函数都是一个watcher，只不过这个watcher是用户的\r\n        createWatcher(vm, key, fn)\r\n      }\r\n    } else {\r\n      createWatcher(vm, key, handler)\r\n    }\r\n  })\r\n}\r\nfunction initComputed (vm) {\r\n  const computed = vm.$options.computed\r\n  vm._computedWatchers = {}\r\n  Object.keys(computed).forEach(key => {\r\n    const value = computed[key]\r\n    // value有2种，一种是对象，一种是函数\r\n    let getter = typeof value === 'function' ? value : value.get\r\n    // 这个getter就是用户getter\r\n    // vm._computedWatchers用于做一个映射表，方便后面我们拿到Watcher\r\n    // getter函数内部的this是指向vm的\r\n    vm._computedWatchers[key] = new Watcher(vm, getter.bind(vm), () => { }, { lazy: true })\r\n    defineComputed(vm, key, value)\r\n  })\r\n}\r\n\r\nfunction createWatcher (vm, key, handler) {\r\n  vm.$watch(key, handler)\r\n}\r\n/**\r\n * \r\n * @param {*} key 计算属性对象中的每一个key，上面已经做了映射表\r\n */\r\nfunction createComputedGetter (key) {\r\n  // 返回后的get回调\r\n  return function () {\r\n    // 这里的this是vm调用的，因为我们定义了Object.defineProperty,第一个参数是vm\r\n    // 因为我们的getter函数也被存到了Watcher中，所以我们需要拿到Watcher然后在特定时机调用即可\r\n    const watcher = this._computedWatchers[key]\r\n    // 计算属性的缓存\r\n    if (watcher.dirty) {\r\n      // 说明是脏的，需要调用用户的回调\r\n      watcher.computedFn()\r\n    }\r\n    // 此时的计算Watcher已经覆盖了渲染Watcher,栈中存放了2个Watcher，一个计算，一个渲染\r\n    if (Dep.target) {\r\n      // 向上收集渲染Watcher\r\n      // 找到相关依赖dep\r\n      watcher.depend()\r\n    }\r\n    return watcher.value\r\n  }\r\n}\r\nfunction defineComputed (vm, key, value) {\r\n  let shareComputed = {}\r\n  if (typeof value === 'function') {\r\n    // 因为计算属性具有缓存功能，所以我们这里用高阶函数返回一个getter，getter是否能被调用取决于dirty属性\r\n    shareComputed.get = createComputedGetter(key)\r\n  } else {\r\n    shareComputed.get = createComputedGetter(key)\r\n    shareComputed.set = value.set\r\n  }\r\n  // 把key定义到vm上面，用于渲染模板\r\n  Object.defineProperty(vm, key, shareComputed)\r\n}\r\n","export function patch (oldVnode, vNode) {\r\n  if (!oldVnode) {\r\n    return createEl(vNode)\r\n  }\r\n  const parent = oldVnode.parentNode\r\n  if (parent && parent.nodeType === 1) {\r\n    // 真实元素\r\n    const elm = createEl(vNode)\r\n    parent.insertBefore(elm, oldVnode.nextSibling)\r\n    parent.removeChild(oldVnode)\r\n    return elm\r\n  } else {\r\n    // diff算法比较\r\n    // console.log(oldVnode, vNode)\r\n    // 第一种，如果标签名不一样，直接新的覆盖老的\r\n    if (oldVnode.tag !== vNode.tag) {\r\n      return oldVnode.el.parentNode.replaceChild(createEl(vNode), oldVnode.el)\r\n    }\r\n    // 说明标签肯定一样，复用老的节点\r\n    let el = vNode.el = oldVnode.el\r\n    // 如果文本不一样,用新的文本替换老的文本\r\n    if (oldVnode.tag === undefined) {\r\n      if (oldVnode.text !== vNode.text) {\r\n        el.textContent = vNode.text\r\n      }\r\n      return\r\n    }\r\n    // 比对属性\r\n    patchProps(vNode, oldVnode.data)\r\n    // 比对孩子\r\n    const oldChildren = oldVnode.children || []\r\n    const newChildren = vNode.children || []\r\n    // 都有孩子\r\n    if (oldChildren.length > 0 && newChildren.length > 0) {\r\n      // 比对孩子\r\n      patchChildren(el, oldChildren, newChildren)\r\n    } else if (oldChildren.length > 0) {\r\n      // 老节点有孩子，新节点没孩子,应该删除孩子\r\n      el.innerHTML = ''\r\n    } else if (newChildren.length > 0) {\r\n      // 新节点有孩子，老节点没孩子,应该添加孩子\r\n      for (let i = 0; i < newChildren.length; i++) {\r\n        el.appendChild(createEl(newChildren[i]))\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction patchChildren (el, oldChildren, newChildren) {\r\n  // 双指针\r\n  let oldStartIndex = 0\r\n  let oldStartNode = oldChildren[oldStartIndex]\r\n  let oldEndIndex = oldChildren.length - 1\r\n  let oldEndNode = oldChildren[oldEndIndex]\r\n\r\n  let newStartIndex = 0\r\n  let newStartNode = newChildren[newStartIndex]\r\n  let newEndIndex = newChildren.length - 1\r\n  let newEndNode = newChildren[newEndIndex]\r\n  while ((oldStartIndex <= oldEndIndex) && (newStartIndex <= newEndIndex)) {\r\n    // 只要新老节点 有一方没有，循环就结束\r\n    if (isSameNode(oldStartNode, newStartNode)) {\r\n      // 头头比较\r\n      // 递归比较文本,标签,属性,子节点\r\n      patch(oldStartNode, newStartNode)\r\n      // 移动指针,更改节点\r\n      oldStartNode = oldChildren[++oldStartIndex]\r\n      newStartNode = newChildren[++newStartIndex]\r\n    } else if (isSameNode(oldEndNode, newEndNode)) {\r\n      // 尾尾比较\r\n      \r\n    }\r\n  }\r\n  // 新增一个的情况\r\n\r\n}\r\n\r\nfunction isSameNode (oldNode, newNode) {\r\n  return (oldNode.tag === newNode.tag) && (oldNode.key === newNode.key)\r\n}\r\n\r\nfunction patchProps (vNode, oldProps = {}) {\r\n  let el = vNode.el\r\n  let newProps = vNode.data || {}\r\n  let newStyle = newProps.style || {}\r\n  let oldStyle = oldProps.style || {}\r\n\r\n  for (let key in oldStyle) {\r\n    // 如果老的样式在新的上面没有，应该删除老的样式\r\n    if (!newStyle[key]) {\r\n      el.style[key] = ''\r\n    }\r\n  }\r\n\r\n  for (let key in oldProps) {\r\n    // 如果老的属性新的上面没有，应该删除老的\r\n    if (!newProps[key]) {\r\n      if (key === 'style') {\r\n        for (let attr in oldProps[key]) {\r\n          el.style[attr] = ''\r\n        }\r\n      } else {\r\n        el.removeAttribute(key)\r\n      }\r\n    }\r\n  }\r\n\r\n  // 循环添加新属性\r\n  for (let key in newProps) {\r\n    if (key === 'style') {\r\n      for (let attr in newProps[key]) {\r\n        el.style[attr] = newProps[key][attr]\r\n      }\r\n    } else {\r\n      el.setAttribute(key, newProps[key])\r\n    }\r\n  }\r\n}\r\n\r\nfunction createComponent (vNode) {\r\n  let i = vNode.data\r\n  if ((i = i.hook) && (i = i.init)) {\r\n    // 调用vNode.data.hook.init\r\n    i(vNode)\r\n  }\r\n  if (vNode.componentInstance) { // 有属性说明子组件new完毕了，并且组件对应的真实DOM挂载到了componentInstance.$el\r\n    return true;\r\n  }\r\n}\r\n\r\nexport function createEl (vNode) {\r\n  const { vm, text, key, children, tag, data } = vNode\r\n  let elm = ''\r\n  if (typeof tag === 'string') {\r\n    if (createComponent(vNode)) {\r\n      // 返回组件对应的真实节点\r\n      return vNode.componentInstance.$el;\r\n    }\r\n    // 标签\r\n    elm = vNode.el = document.createElement(tag) // 虚拟节点上面都有一个el属性，对应真实元素，在做diff算法比较的时候有用\r\n    patchProps(vNode)\r\n    if (children && children.length) {\r\n      for (let i = 0; i < children.length; i++) {\r\n        const item = children[i]\r\n        elm.appendChild(createEl(item))\r\n      }\r\n    }\r\n  } else {\r\n    // 文本\r\n    elm = vNode.el = document.createTextNode(text)\r\n  }\r\n  return elm\r\n}","import { patch } from './vDom/patch'\r\nimport { nextTick } from './utils'\r\nimport Watcher from './observe/watcher'\r\nexport function mountComponent (vm, el) {\r\n  // 挂载组件之前调用beforeMount钩子\r\n  callHooks(vm, 'beforeMount')\r\n  const updateComponent = () => {\r\n    // 生成虚拟dom\r\n    const vNode = vm._render()\r\n    // 更新\r\n    vm._update(vNode)\r\n  }\r\n  // updateComponent() ==> 更新组件\r\n  // 这里渲染的时候我们创建一个Watcher，在Watcher中更新组件\r\n  new Watcher(vm, updateComponent, () => {\r\n    console.log('update view')\r\n  }, true) // true代表是一个渲染Watcher\r\n  callHooks(vm, 'mounted')\r\n}\r\nexport function lifecycleMixin (Vue) {\r\n  Vue.prototype._update = function (vNode) {\r\n    const vm = this\r\n    vm.$el = patch(vm.$el, vNode)\r\n  }\r\n  Vue.prototype.$nextTick = nextTick\r\n}\r\n\r\n// 调用指定的钩子函数\r\nexport function callHooks (vm, hook) {\r\n  // 拿到Vue.options上经过mixin合并的hook\r\n  // const handlers = vm.constructor.options[hook]\r\n  // 因为我们将Vue.options和vm.$options进行了合并，让mixin中的数据可以混入到组件中，所以我们直接调用组件的$options中的钩子就行(已经被合并过了)\r\n  const handlers = vm.$options[hook]\r\n  // console.log(handlers, hook)\r\n  if (handlers) {\r\n    for (let i = 0; i < handlers.length; i++) {\r\n      const handler = handlers[i]\r\n      // 钩子内部的this指向的是当前组件实例\r\n      handler.call(vm)\r\n    }\r\n  }\r\n}\r\n\r\n\r\n","import { compileTemplate } from '../utils'\r\nexport function parserHtml (html) {\r\n  /**\r\n   * 用正则匹配标签开始，标签名，然后提取标签名放入容器中，然后移除掉匹配的部分 \r\n   * 用正则匹配标签属性，然后提取属性放入容器中，然后移除掉匹配的部分\r\n   * 用正则匹配标签结束，然后移除掉匹配的部分\r\n   * 用正则匹配标签中的文本，然后提取文本放入容器中，然后移除掉匹配的部分\r\n   * 用正则匹配标签结束，然后提取标签结束名和标签开始的标签名进行匹配，如果相同，说明标签相同，不相同，抛错\r\n   */\r\n  // 树根\r\n  let root = null\r\n  function advance (len) {\r\n    html = html.substring(len)\r\n  }\r\n  // 栈\r\n  const stack = []\r\n  // 创建ast语法树\r\n  function createAstElement (tag, attrs) {\r\n    return {\r\n      tag,\r\n      parent: null,\r\n      children: [],\r\n      attrs,\r\n      type: 1,\r\n      text: ''\r\n    }\r\n  }\r\n  function start (tag, attributes) {\r\n\r\n    // console.log('标签开始', tag, attributes)\r\n    // 取出栈中最后一个\r\n    const parent = stack[stack.length - 1]\r\n    // 创建ast元素\r\n    const element = createAstElement(tag, attributes)\r\n    // 如果没有根元素，那么创建出来的ast元素就是根元素\r\n    if (!root) {\r\n      root = element\r\n    }\r\n    if (parent) {\r\n      // 有父级元素\r\n      parent.children.push(element)\r\n      element.parent = parent\r\n    }\r\n    stack.push(element)\r\n  }\r\n  function chars (text) {\r\n    // console.log('标签文本', text)\r\n    const parent = stack[stack.length - 1]\r\n    text = text.replace(/\\s/g, '')\r\n    if (text) {\r\n      parent.children.push({\r\n        type: 3,\r\n        text\r\n      })\r\n    }\r\n  }\r\n  function end (tag) {\r\n    // console.log('标签结束', tag)\r\n    const element = stack.pop()\r\n    if (element.tag !== tag) {\r\n      throw new Error('标签有误')\r\n    }\r\n  }\r\n  // 解析开始标签\r\n  function parseStartTag () {\r\n    let startTag = compileTemplate.startTag(html)\r\n    if (startTag) {\r\n      advance(startTag[0].length)\r\n      let match = {\r\n        tag: startTag[1],\r\n        attrs: []\r\n      }\r\n      let text, end\r\n      // 匹配属性,只要没有到结束标签并且一直都可以匹配到属性，就一直循环\r\n      while (!(end = compileTemplate.tagClose(html)) && (text = compileTemplate.tagAttributes(html))) {\r\n        match.attrs.push({\r\n          key: text[1],\r\n          value: text[2] || text[3] || text[4]\r\n        })\r\n        advance(text[0].length)\r\n      }\r\n      if (end) {\r\n        advance(end[0].length)\r\n      }\r\n      return match\r\n    }\r\n    return false\r\n  }\r\n  // 解析结束标签\r\n  function parseEndTag () {\r\n    let endTag = compileTemplate.closeTag(html)\r\n    if (endTag) {\r\n      advance(endTag[0].length)\r\n      return endTag[1]\r\n    }\r\n    return false\r\n  }\r\n  while (html) {\r\n    let index = html.indexOf('<')\r\n    if (index === 0) {\r\n      // 不是标签开始位置就是标签结束位置\r\n      // 解析开始标签\r\n      let startMatch = parseStartTag()\r\n      if (startMatch) {\r\n        start(startMatch.tag, startMatch.attrs)\r\n        continue\r\n      }\r\n      let endMatch = parseEndTag()\r\n      if (endMatch) {\r\n        end(endMatch)\r\n        continue\r\n      }\r\n    }\r\n    // 拿到文本的所有内容\r\n    let text = html.slice(0, index)\r\n    if (text) {\r\n      chars(text)\r\n      advance(text.length)\r\n    }\r\n  }\r\n  return root\r\n}","import { compileTemplate } from '../utils'\r\nfunction gen (c) {\r\n  if (c.type === 1) {\r\n    // 元素\r\n    return generate(c)\r\n  } else {\r\n    // 文本 _v('hello')\r\n    const text = c.text\r\n    const regRes = compileTemplate.qn(text)\r\n    // 如果没有匹配到插值语法 hello {{name}} world  ==> 'hello' + name + 'world'\r\n    if (!regRes) {\r\n      return `_v('${text}')`\r\n    } else {\r\n      const reg = compileTemplate.qn(text, 0)\r\n      let tokens = []\r\n      let lastIndex = 0\r\n      text.replace(reg, function (...args) {\r\n        if (text.slice(lastIndex, args[2])) {\r\n          tokens.push(JSON.stringify(text.slice(lastIndex, args[2])))\r\n        }\r\n        if (lastIndex < text.length - 1) {\r\n          tokens.push(args[1].trim())\r\n        }\r\n        lastIndex = args[2] + (args[0].length)\r\n      })\r\n      if (lastIndex < text.length) {\r\n        if (text.slice(lastIndex)) {\r\n          tokens.push(JSON.stringify(text.slice(lastIndex)))\r\n        }\r\n      }\r\n      return `_v(${tokens.join('+')})`\r\n    }\r\n  }\r\n}\r\nfunction genChildren (root) {\r\n  const children = root.children\r\n  if (children && children.length) {\r\n    const res = children.map(c => gen(c)).join(',')\r\n    return res\r\n  }\r\n  return false\r\n}\r\nfunction genProps (props) {\r\n  let str = ''\r\n  for (let i = 0; i < props.length; i++) {\r\n    let { key, value } = props[i]\r\n    if (key === 'style') {\r\n      let styleObj = {}\r\n      // \"color: red;background-color: #fff\"; 转成对象\r\n      value.replace(/([^:;]+):([^:;]+)/g, function (p, s1, s2) {\r\n        styleObj[s1] = s2\r\n      })\r\n      value = styleObj\r\n    }\r\n    str += `${key}:${JSON.stringify(value)},`\r\n  }\r\n  return `{${str.slice(0, -1)}}`\r\n}\r\nexport function generate (root) {\r\n  // 将ast语法树拼接成字符串\r\n  /**\r\n   * _c('div',{id:'root',name:'zhengchangfu'},'hello')\r\n   * new Function + with语法\r\n   */\r\n  const children = genChildren(root)\r\n  let code = `_c('${root.tag}',${root.attrs.length ? genProps(root.attrs) : 'undefined'}${children ? `,${children}` : ''})`\r\n  //code ==>  _c('div',{id:\"root\",name:\"zhengchangfu\",style:{\"color\":\" red\",\"background-color\":\" #fff\"}},_c('p',undefined,_c('span',undefined,_v(\"我叫\"+name+\"哈哈\"))))\r\n  return code\r\n} ","import { parserHtml } from './parser'\r\nimport { generate } from './generate'\r\nexport function CompileToFunction (html) {\r\n  // 将html编译成ast语法树\r\n  let root = parserHtml(html)\r\n  // 将ast语法树转换成代码\r\n  let code = generate(root)\r\n  // console.log(code, 'code')\r\n  // 将code代码串转成函数\r\n  let render = new Function(`with(this){return ${code}}`)\r\n  // console.log(render, 'render')\r\n  /**\r\n   * ƒ anonymous(){\r\n      with(this){\r\n        return _c(\r\n          'div',\r\n          {\r\n            id:\"root\",\r\n            name:\"zhengchangfu\",\r\n            style:{\r\n              \"color\":\" red\",\r\n              \"background-color\":\" #fff\"\r\n            }\r\n          },\r\n          _c(\r\n            'p',\r\n            undefined,\r\n            _c(\r\n              'span',\r\n              undefined,\r\n              _v(\r\n                \"我叫\"+name+\"哈哈\"\r\n                )\r\n              )\r\n            )\r\n          )\r\n       }\r\n    }\r\n   */\r\n  return render\r\n}\r\n","import { initState } from './state'\r\nimport { mountComponent } from './lifecycle'\r\nimport { CompileToFunction } from './compile/index'\r\nimport { callHooks } from './lifecycle'\r\nimport { mergeOptions } from './utils'\r\nexport function initMixin (Vue) {\r\n  Vue.prototype._init = function (options) {\r\n    const vm = this\r\n    // vm.$options = options\r\n    // 将$options中的选项和Vue.options进行合并，这样的话，mixin中就可以混入数据到组件中\r\n    vm.$options = mergeOptions(vm.constructor.options, options)\r\n    // 初始化数据之前调用beforeCreate\r\n    callHooks(vm, 'beforeCreate')\r\n    initState(vm)\r\n    // 初始化数据之后调用created\r\n    callHooks(vm, 'created')\r\n    // 挂载\r\n    if (vm.$options.el) {\r\n      vm.$mount(vm.$options.el)\r\n    }\r\n  }\r\n  Vue.prototype.$mount = function (el) {\r\n    const vm = this;\r\n    const options = vm.$options\r\n    el = document.querySelector(el);\r\n    vm.$el = el;\r\n    // 把模板转化成 对应的渲染函数 =》 虚拟dom概念 vnode =》 diff算法 更新虚拟dom =》 产生真实节点，更新\r\n    if (!options.render) { // 没有render用template，目前没render\r\n      let template = options.template;\r\n      if (!template && el) { // 用户也没有传递template 就取el的内容作为模板\r\n        template = el.outerHTML;\r\n      }\r\n      let render = CompileToFunction(template);\r\n      options.render = render;\r\n    }\r\n    // 挂载组件\r\n    mountComponent(vm, el)\r\n  }\r\n}","import { isReverseTag, isObject } from '../utils'\r\nexport function createElement (vm, tag, data = {}, ...children) {\r\n  // 判断是否为原生标签，如果是原生标签，就渲染原生的虚拟节点\r\n  // 反之，渲染组件的虚拟节点\r\n  if (isReverseTag(tag)) {\r\n    return createVDom(vm, tag, data, data.key, children, undefined)\r\n  } else {\r\n    // 说明是组件，应该返回组件的虚拟节点\r\n    const Ctor = vm.$options.components[tag]\r\n    return createComponent(vm, tag, data, data.key, children, Ctor)\r\n  }\r\n}\r\n\r\nfunction createComponent (vm, tag, data, key, children, Ctor) {\r\n  if (isObject(Ctor)) {\r\n    // 外面在new Vue中传入的components也会被extend，等同于Vue.component()\r\n    Ctor = vm.$options._base.extend(Ctor)\r\n  }\r\n  data.hook = {\r\n    init (vNode) {\r\n      // 调用子组件\r\n      if (Ctor) {\r\n        let vm = vNode.componentInstance = new Ctor({ isComponent: true })\r\n        vm.$mount()\r\n      }\r\n    }\r\n  }\r\n  // 组件的虚拟节点\r\n  // console.log(createVDom(vm, `vue-componnet-${tag}`, data, key, undefined, undefined, { Ctor, children }))\r\n  return createVDom(vm, `vue-componnet-${tag}`, data, key, undefined, undefined, { Ctor, children })\r\n}\r\n\r\nexport function createText (vm, text) {\r\n  return createVDom(vm, undefined, undefined, undefined, undefined, text)\r\n}\r\nfunction createVDom (vm, tag, data, key, children, text, componentOptions) {\r\n  return {\r\n    vm,\r\n    tag,\r\n    data,\r\n    key,\r\n    children,\r\n    text,\r\n    componentOptions\r\n  }\r\n}","\r\nimport { createElement, createText } from './vDom/index'\r\nexport function renderMixin (Vue) {\r\n  // 创建元素\r\n  Vue.prototype._c = function (...args) {\r\n    return createElement(this, ...args)\r\n  }\r\n  // 创建文本\r\n  Vue.prototype._v = function (text) {\r\n    return createText(this, text)\r\n  }\r\n  Vue.prototype._render = function () {\r\n    const vm = this\r\n    const render = vm.$options.render\r\n    let vNode = render.call(vm)\r\n    return vNode\r\n  }\r\n}","/**\r\n * Vue的全局方法模块\r\n */\r\nimport { mergeOptions } from '../utils'\r\nexport function globalMixin (Vue) {\r\n  Vue.options = {}\r\n  Vue.mixin = function (options) {\r\n    // 每次调用mixin方法都会进行合并，然后记录下来，放到Vue.options属性上\r\n    this.options = mergeOptions(this.options, options)\r\n  }\r\n  // 为了让以后所有的组件都可以拿到这个属性\r\n  Vue.options._base = Vue\r\n  // 用component方法注册的组件会被放到这里\r\n  Vue.options.components = {}\r\n  Vue.component = function (id, options) {\r\n    options = this.options._base.extend(options)\r\n    this.options.components[id] = options\r\n  }\r\n  Vue.extend = function (options) {\r\n    const Super = this\r\n    let Sub = function VueComponent (options) {\r\n      this._init(options)\r\n    }\r\n    // 继承\r\n    // 相当于Sub.prototype.__proto__ = Super.prototype\r\n    Sub.prototype = Object.create(Super.prototype)\r\n    // 修正此继承bug\r\n    Sub.prototype.constructor = Sub\r\n    // 合并,每个组件都有一个自己的options选项，options选项会和Vue.options选项进行合并操作\r\n    Sub.options = mergeOptions(Super.options, options)\r\n    return Sub\r\n  }\r\n}","import { initMixin } from './init'\r\nimport { renderMixin } from './render'\r\nimport { lifecycleMixin } from './lifecycle'\r\nimport { stateMixin } from './state'\r\nimport { globalMixin } from './global-api/index.js'\r\nfunction Vue (options) {\r\n  this._init(options)\r\n}\r\ninitMixin(Vue)\r\nrenderMixin(Vue)\r\nlifecycleMixin(Vue)\r\nstateMixin(Vue)\r\nglobalMixin(Vue)\r\n\r\n\r\nimport { CompileToFunction } from './compile/index'\r\nimport { createEl, patch } from './vDom/patch'\r\n\r\n// 第一种:如果标签不一样，直接用新的标签替换掉老的标签\r\n// let oldTemplate = `<p>{{message}}</p>`\r\n\r\n// 第二种:比对属性\r\n// let oldTemplate = `<div a=\"1\" style=\"font-size:14px;\">1</div>`\r\n\r\n// 第三种:如果没有标签，文本不一样，直接替换文本\r\n// let oldTemplate = `{{message}}`\r\n\r\n// 第四种:如果标签一样，老的有孩子,新的没孩子\r\n// let oldTemplate = `<div><li>A</li></div>`\r\n\r\n// 第五种:如果标签一样，老的没孩子,新的有孩子\r\n// let oldTemplate = `<div></div>`\r\n\r\n// 第六种:都有孩子\r\nlet oldTemplate = `<div>\r\n<li>A</li>\r\n<li>B</li>\r\n<li>C</li>\r\n</div>`\r\nlet render1 = CompileToFunction(oldTemplate)\r\n\r\nlet vm1 = new Vue({\r\n  data: {\r\n    message: 1\r\n  }\r\n})\r\nconst oldNode = render1.call(vm1)\r\ndocument.body.appendChild(createEl(oldNode))\r\n\r\n\r\n// 第一种:如果标签不一样，直接用新的标签替换掉老的标签\r\n// let newTemplate = `<div>{{message}}</div>`\r\n\r\n// 第二种: 标签一样，对比属性\r\n// let newTemplate = `<div a=\"b\" style=\"color:red;\">1</div>`\r\n\r\n// 第三种:如果没有标签，文本不一样，直接替换文本\r\n// let newTemplate = `{{message}}`\r\n\r\n// 第四种:如果标签一样，老的有孩子,新的没孩子\r\n// let newTemplate = `<div></div>`\r\n\r\n// 第五种:如果标签一样，老的没孩子,新的有孩子\r\n// let newTemplate = `<div><li>A</li></div>`\r\n\r\n// 第六种:都有孩子\r\nlet newTemplate = `<div>\r\n<li>A</li>\r\n<li>D</li>\r\n<li>C</li>\r\n</div>`\r\n\r\nlet render2 = CompileToFunction(newTemplate)\r\n\r\nlet vm2 = new Vue({\r\n  data: {\r\n    message: 2\r\n  }\r\n})\r\nconst newNode = render2.call(vm2)\r\n\r\nsetTimeout(() => {\r\n  patch(oldNode, newNode)\r\n}, 2000)\r\n\r\nexport default Vue"],"names":["isFunction","val","isObject","isArray","Array","compileTemplate","tag","startTag","html","reg","RegExp","match","tagAttributes","text","tagClose","closeTag","qn","count","callbacks","watting","nextTick","cb","push","Promise","resolve","then","flushCallbacks","i","length","hooks","stracts","hook","mergeHook","components","parentValue","childValue","options","Object","create","key","concat","mergeOptions","parent","child","obj","mergeField","isReverseTag","str","includes","oldArrayProto","prototype","arrayMethods","methods","forEach","method","args","call","ob","__ob__","inserted","slice","observeArray","dep","notify","id","Dep","subs","target","addDeps","watcher","update","stack","pushTarget","popTarget","pop","Observe","data","defineProperty","value","enumerable","__proto__","walk","item","observe","keys","defineReactive","dependArray","current","depend","childOb","get","set","newVal","queue","pending","queueWatcher","flushSchedulerQueue","run","Watcher","vm","updateFnOrExpr","user","lazy","dirty","deps","depsId","Set","arr","split","undefined","has","add","addSubs","oldValue","stateMixin","Vue","$watch","handler","initState","$options","initData","watch","initWatch","computed","initComputed","proxy","source","_data","fn","createWatcher","_computedWatchers","getter","bind","defineComputed","createComputedGetter","computedFn","shareComputed","patch","oldVnode","vNode","createEl","parentNode","nodeType","elm","insertBefore","nextSibling","removeChild","el","replaceChild","textContent","patchProps","oldChildren","children","newChildren","patchChildren","innerHTML","appendChild","oldStartIndex","oldStartNode","oldEndIndex","oldEndNode","newStartIndex","newStartNode","newEndIndex","newEndNode","isSameNode","oldNode","newNode","oldProps","newProps","newStyle","style","oldStyle","attr","removeAttribute","setAttribute","createComponent","init","componentInstance","$el","document","createElement","createTextNode","mountComponent","callHooks","updateComponent","_render","_update","console","log","lifecycleMixin","$nextTick","handlers","parserHtml","root","advance","len","substring","createAstElement","attrs","type","start","attributes","element","chars","replace","end","Error","parseStartTag","parseEndTag","endTag","index","indexOf","startMatch","endMatch","gen","c","generate","regRes","tokens","lastIndex","JSON","stringify","trim","join","genChildren","res","map","genProps","props","styleObj","p","s1","s2","code","CompileToFunction","render","Function","initMixin","_init","constructor","$mount","querySelector","template","outerHTML","createVDom","Ctor","_base","extend","isComponent","createText","componentOptions","renderMixin","_c","_v","globalMixin","mixin","component","Super","Sub","VueComponent","oldTemplate","render1","vm1","message","body","newTemplate","render2","vm2","setTimeout"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAO,IAAMA,UAAU,GAAG,SAAbA,UAAa,CAAAC,GAAG,EAAI;EAC/B,SAAO,OAAOA,GAAP,KAAe,UAAtB;EACD,CAFM;EAGA,IAAMC,QAAQ,GAAG,SAAXA,QAAW,CAAAD,GAAG,EAAI;EAC7B,SAAO,QAAOA,GAAP,MAAe,QAAf,IAA2BA,GAAG,KAAK,IAA1C;EACD,CAFM;EAGA,IAAME,OAAO,GAAG,SAAVA,OAAU,CAAAF,GAAG,EAAI;EAC5B,SAAOG,KAAK,CAACD,OAAN,CAAcF,GAAd,CAAP;EACD,CAFM;EAIA,IAAII,eAAe,GAAG;EAC3B;EACAC,EAAAA,GAAG,yBAFwB;EAG3B;EACAC,EAAAA,QAAQ,EAAE,kBAAAC,IAAI,EAAI;EAChB,QAAMC,GAAG,GAAG,IAAIC,MAAJ,cAAiBL,eAAe,CAACC,GAAjC,OAAZ;EACA,WAAOE,IAAI,CAACG,KAAL,CAAWF,GAAX,CAAP;EACD,GAP0B;EAQ3B;EACAG,EAAAA,aAAa,EAAE,uBAAAC,IAAI,EAAI;EACrB;EACA,QAAMJ,GAAG,GAAG,sEAAZ;EACA,WAAOI,IAAI,CAACF,KAAL,CAAWF,GAAX,CAAP;EACD,GAb0B;EAc3B;EACAK,EAAAA,QAAQ,EAAE,kBAAAD,IAAI,EAAI;EAChB;EACA,QAAMJ,GAAG,GAAG,YAAZ;EACA,WAAOI,IAAI,CAACF,KAAL,CAAWF,GAAX,CAAP;EACD,GAnB0B;EAoB3B;EACAM,EAAAA,QAAQ,EAAE,kBAAAF,IAAI,EAAI;EAChB;EACA,QAAMJ,GAAG,GAAG,IAAIC,MAAJ,eAAmBL,eAAe,CAACC,GAAnC,SAAZ;EACA,WAAOO,IAAI,CAACF,KAAL,CAAWF,GAAX,CAAP;EACD,GAzB0B;EA0B3B;EACAO,EAAAA,EAAE,EAAE,YAACH,IAAD,EAAqB;EAAA,QAAdI,KAAc,uEAAN,CAAM;EACvB,QAAMR,GAAG,GAAG,qBAAZ;EACA,WAAOQ,KAAK,GAAGJ,IAAI,CAACF,KAAL,CAAWF,GAAX,CAAH,GAAqBA,GAAjC;EACD;EA9B0B,CAAtB;EAkCP,IAAIS,SAAS,GAAG,EAAhB;EACA,IAAIC,OAAO,GAAG,KAAd;EACO,SAASC,QAAT,CAAmBC,EAAnB,EAAuB;EAC5B;EACAH,EAAAA,SAAS,CAACI,IAAV,CAAeD,EAAf,EAF4B;;EAI5B,MAAI,CAACF,OAAL,EAAc;EACZA,IAAAA,OAAO,GAAG,IAAV;EACAI,IAAAA,OAAO,CAACC,OAAR,GAAkBC,IAAlB,CAAuBC,cAAvB;EACD;EACF;;EACD,SAASA,cAAT,GAA2B;EACzB,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGT,SAAS,CAACU,MAA9B,EAAsCD,CAAC,EAAvC,EAA2C;EACzC,QAAMN,EAAE,GAAGH,SAAS,CAACS,CAAD,CAApB;EACAN,IAAAA,EAAE;EACH;;EACDH,EAAAA,SAAS,GAAG,EAAZ;EACAC,EAAAA,OAAO,GAAG,KAAV;EACD;;EAED,IAAMU,KAAK,GAAG,CACZ,cADY,EAEZ,SAFY,EAGZ,aAHY,EAIZ,SAJY,EAKZ,cALY,EAMZ,SANY,EAOZ,eAPY,EAQZ,WARY,CAAd;EAUA,IAAMC,OAAO,GAAG,EAAhB;;EACA,KAAK,IAAIH,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGE,KAAK,CAACD,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;EACrC,MAAMI,IAAI,GAAGF,KAAK,CAACF,CAAD,CAAlB;EACAG,EAAAA,OAAO,CAACC,IAAD,CAAP,GAAgBC,SAAhB;EACD;;EAGD;EACA;EACA;;;EACAF,OAAO,CAACG,UAAR,GAAqB,UAAUC,WAAV,EAAuBC,UAAvB,EAAmC;EACtD;EACA,MAAIC,OAAO,GAAGC,MAAM,CAACC,MAAP,CAAcJ,WAAd,CAAd;;EACA,MAAIC,UAAJ,EAAgB;EACd,SAAK,IAAII,GAAT,IAAgBJ,UAAhB,EAA4B;EAC1BC,MAAAA,OAAO,CAACG,GAAD,CAAP,GAAeJ,UAAU,CAACI,GAAD,CAAzB;EACD;EACF;;EACD,SAAOH,OAAP;EACD,CATD;;;EAYA,SAASJ,SAAT,CAAoBE,WAApB,EAAiCC,UAAjC,EAA6C;EAC3C,MAAIA,UAAJ,EAAgB;EACd,QAAID,WAAJ,EAAiB;EACf,aAAOA,WAAW,CAACM,MAAZ,CAAmBL,UAAnB,CAAP,CADe;EAEhB,KAFD,MAEO;EACL,aAAO,CAACA,UAAD,CAAP,CADK;EAEN;EACF,GAND,MAMO;EACL,WAAOD,WAAP;EACD;EACF;;EAGM,SAASO,YAAT,CAAuBC,MAAvB,EAA+BC,KAA/B,EAAsC;EAC3C,MAAIC,GAAG,GAAG,EAAV;;EACA,OAAK,IAAIL,GAAT,IAAgBG,MAAhB,EAAwB;EACtBG,IAAAA,UAAU,CAACN,GAAD,CAAV;EACD;;EACD,OAAK,IAAIA,IAAT,IAAgBI,KAAhB,EAAuB;EACrBE,IAAAA,UAAU,CAACN,IAAD,CAAV;EACD;;EACD,WAASM,UAAT,CAAqBN,GAArB,EAA0B;EACxB;EACJ;EACA;EACA;EACA;EACA;EACA;EACA;EACI,QAAML,WAAW,GAAGQ,MAAM,CAACH,GAAD,CAA1B;EACA,QAAMJ,UAAU,GAAGQ,KAAK,CAACJ,GAAD,CAAxB,CAVwB;;EAYxB,QAAIT,OAAO,CAACS,GAAD,CAAX,EAAkB;EAChBK,MAAAA,GAAG,CAACL,GAAD,CAAH,GAAWT,OAAO,CAACS,GAAD,CAAP,CAAaL,WAAb,EAA0BC,UAA1B,CAAX;EACD,KAFD,MAEO;EACL;EACA;EACA,UAAIjC,QAAQ,CAACgC,WAAD,CAAR,IAAyBhC,QAAQ,CAACiC,UAAD,CAArC,EAAmD;EACjDS,QAAAA,GAAG,CAACL,GAAD,CAAH,qCAAgBL,WAAhB,GAAgCC,UAAhC;EACD,OAFD,MAEO;EACL;EACAS,QAAAA,GAAG,CAACL,GAAD,CAAH,GAAWJ,UAAU,IAAID,WAAzB;EACD;EACF;EACF;;EACD,SAAOU,GAAP;EACD;EAEM,SAASE,YAAT,CAAuBxC,GAAvB,EAA4B;EACjC;EACA,MAAMyC,GAAG,GAAG,8BAAZ;EACA,SAAOA,GAAG,CAACC,QAAJ,CAAa1C,GAAb,CAAP;EACD;;ECrJD,IAAM2C,aAAa,GAAG7C,KAAK,CAAC8C,SAA5B;EACO,IAAMC,YAAY,GAAGd,MAAM,CAACC,MAAP,CAAcW,aAAd,CAArB;EACP,IAAIG,OAAO,GAAG,CACZ,OADY,EAEZ,SAFY,EAGZ,MAHY,EAIZ,KAJY,EAKZ,QALY,EAMZ,MANY,EAOZ,SAPY,CAAd;EAUAA,OAAO,CAACC,OAAR,CAAgB,UAAAC,MAAM,EAAI;EACxB;EACAH,EAAAA,YAAY,CAACG,MAAD,CAAZ,GAAuB,YAAmB;EAAA;;EAAA,sCAANC,IAAM;EAANA,MAAAA,IAAM;EAAA;;EACxC,6BAAAN,aAAa,CAACK,MAAD,CAAb,EAAsBE,IAAtB,+BAA2B,IAA3B,SAAoCD,IAApC;;EACA,QAAIE,EAAE,GAAG,KAAKC,MAAd,CAFwC;EAIxC;;EACA,QAAIC,QAAJ;;EACA,YAAQL,MAAR;EACE,WAAK,MAAL;EACA,WAAK,SAAL;EACEK,QAAAA,QAAQ,GAAGJ,IAAX;EACA;;EACF,WAAK,QAAL;EACEI,QAAAA,QAAQ,GAAGJ,IAAI,CAACK,KAAL,CAAW,CAAX,CAAX;EACA;EAPJ;;EAYA,QAAID,QAAJ,EAAc;EACZ;EACA;EACAF,MAAAA,EAAE,CAACI,YAAH,CAAgBF,QAAhB;EACD,KAtBuC;;;EAwBxCF,IAAAA,EAAE,CAACK,GAAH,CAAOC,MAAP;EACD,GAzBD;EA0BD,CA5BD;;ECZA,IAAIC,EAAE,GAAG,CAAT;;MACMC;EACJ,iBAAc;EAAA;;EACZ,SAAKD,EAAL,GAAUA,EAAE,EAAZ;EACA,SAAKE,IAAL,GAAY,EAAZ;EACD;;;;aACD,kBAAU;EACR,UAAID,GAAG,CAACE,MAAR,EAAgB;EACd;EACAF,QAAAA,GAAG,CAACE,MAAJ,CAAWC,OAAX,CAAmB,IAAnB,EAFc;EAGf;EACF;;;aACD,iBAASC,OAAT,EAAkB;EAChB,WAAKH,IAAL,CAAU5C,IAAV,CAAe+C,OAAf;EACD;;;aACD,kBAAU;EACR,WAAKH,IAAL,CAAUb,OAAV,CAAkB,UAAAgB,OAAO;EAAA,eAAIA,OAAO,CAACC,MAAR,EAAJ;EAAA,OAAzB;EACD;;;;;;EAGHL,GAAG,CAACE,MAAJ,GAAa,IAAb;EACA,IAAII,KAAK,GAAG,EAAZ;EACO,SAASC,UAAT,CAAqBH,OAArB,EAA8B;EACnCJ,EAAAA,GAAG,CAACE,MAAJ,GAAaE,OAAb;EACAE,EAAAA,KAAK,CAACjD,IAAN,CAAW+C,OAAX;EACD;EACM,SAASI,SAAT,GAAsB;EAC3B;EACAF,EAAAA,KAAK,CAACG,GAAN;EACAT,EAAAA,GAAG,CAACE,MAAJ,GAAaI,KAAK,CAACA,KAAK,CAAC3C,MAAN,GAAe,CAAhB,CAAlB;EACD;;MC3BK+C;EACJ,mBAAYC,IAAZ,EAAkB;EAAA;;EAChB;EACA,SAAKd,GAAL,GAAW,IAAIG,GAAJ,EAAX,CAFgB;EAIhB;;EACA5B,IAAAA,MAAM,CAACwC,cAAP,CAAsBD,IAAtB,EAA4B,QAA5B,EAAsC;EACpCE,MAAAA,KAAK,EAAE,IAD6B;EAEpCC,MAAAA,UAAU,EAAE,KAFwB;;EAAA,KAAtC,EALgB;;EAUhB,QAAI5E,OAAO,CAACyE,IAAD,CAAX,EAAmB;EACjB;EACAA,MAAAA,IAAI,CAACI,SAAL,GAAiB7B,YAAjB;EACA,WAAKU,YAAL,CAAkBe,IAAlB,EAHiB;EAIlB,KAJD,MAIO;EACL,WAAKK,IAAL,CAAUL,IAAV;EACD;EACF;;;;aACD,sBAAcA,IAAd,EAAoB;EAClBA,MAAAA,IAAI,CAACvB,OAAL,CAAa,UAAA6B,IAAI,EAAI;EACnBC,QAAAA,OAAO,CAACD,IAAD,CAAP;EACD,OAFD;EAGD;;;aACD,cAAMN,IAAN,EAAY;EACVvC,MAAAA,MAAM,CAAC+C,IAAP,CAAYR,IAAZ,EAAkBvB,OAAlB,CAA0B,UAAAd,GAAG,EAAI;EAC/B,YAAMuC,KAAK,GAAGF,IAAI,CAACrC,GAAD,CAAlB;EACA8C,QAAAA,cAAc,CAACT,IAAD,EAAOrC,GAAP,EAAYuC,KAAZ,CAAd;EACD,OAHD;EAID;;;;;;EAGH,SAASQ,WAAT,CAAsBR,KAAtB,EAA6B;EAC3B,OAAK,IAAInD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmD,KAAK,CAAClD,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;EACrC,QAAI4D,OAAO,GAAGT,KAAK,CAACnD,CAAD,CAAnB,CADqC;;EAErC4D,IAAAA,OAAO,CAAC7B,MAAR,IAAkB6B,OAAO,CAAC7B,MAAR,CAAeI,GAAf,CAAmB0B,MAAnB,EAAlB;;EACA,QAAIpF,KAAK,CAACD,OAAN,CAAcoF,OAAd,CAAJ,EAA4B;EAC1BD,MAAAA,WAAW,CAACC,OAAD,CAAX;EACD;EACF;EACF;;EACD,SAASF,cAAT,CAAyBT,IAAzB,EAA+BrC,GAA/B,EAAoCuC,KAApC,EAA2C;EACzC;EACA,MAAIW,OAAO,GAAGN,OAAO,CAACL,KAAD,CAArB,CAFyC;;EAIzC,MAAIhB,GAAG,GAAG,IAAIG,GAAJ,EAAV;EACA5B,EAAAA,MAAM,CAACwC,cAAP,CAAsBD,IAAtB,EAA4BrC,GAA5B,EAAiC;EAC/BmD,IAAAA,GAD+B,iBACxB;EACL;EACA,UAAIzB,GAAG,CAACE,MAAR,EAAgB;EACdL,QAAAA,GAAG,CAAC0B,MAAJ,GADc;EAEd;EACA;;EACA,YAAIC,OAAJ,EAAa;EACX;EACAA,UAAAA,OAAO,CAAC3B,GAAR,CAAY0B,MAAZ,GAFW;;EAIX,cAAIpF,KAAK,CAACD,OAAN,CAAc2E,KAAd,CAAJ,EAA0B;EACxBQ,YAAAA,WAAW,CAACR,KAAD,CAAX;EACD;EACF;EACF;;EACD,aAAOA,KAAP;EACD,KAjB8B;EAkB/Ba,IAAAA,GAlB+B,eAkB1BC,MAlB0B,EAkBlB;EACX,UAAId,KAAK,KAAKc,MAAd,EAAsB;EACpB;EACAT,QAAAA,OAAO,CAACS,MAAD,CAAP;EACAd,QAAAA,KAAK,GAAGc,MAAR,CAHoB;;EAKpB9B,QAAAA,GAAG,CAACC,MAAJ;EACD;EACF;EA1B8B,GAAjC;EA4BD;;EAEM,SAASoB,OAAT,CAAkBP,IAAlB,EAAwB;EAC7B,MAAI,CAAC1E,QAAQ,CAAC0E,IAAD,CAAb,EAAqB;EACrB,MAAIA,IAAI,CAAClB,MAAT,EAAiB,OAAOkB,IAAI,CAAClB,MAAZ;EACjB,SAAO,IAAIiB,OAAJ,CAAYC,IAAZ,CAAP;EACD;;EClFD,IAAIiB,KAAK,GAAG,EAAZ;EACA,IAAIjD,GAAG,GAAG,EAAV;EACA,IAAIkD,OAAO,GAAG,KAAd;EACO,SAASC,YAAT,CAAuB1B,OAAvB,EAAgC;EACrC,MAAML,EAAE,GAAGK,OAAO,CAACL,EAAnB;;EACA,MAAI,CAACpB,GAAG,CAACoB,EAAD,CAAR,EAAc;EACZ6B,IAAAA,KAAK,CAACvE,IAAN,CAAW+C,OAAX;EACAzB,IAAAA,GAAG,CAACoB,EAAD,CAAH,GAAU,IAAV;;EACA,QAAI,CAAC8B,OAAL,EAAc;EACZA,MAAAA,OAAO,GAAG,IAAV;EACA1E,MAAAA,QAAQ,CAAC4E,mBAAD,CAAR;EACD;EACF;EACF;;EAED,SAASA,mBAAT,GAAgC;EAC9B,OAAK,IAAIrE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGkE,KAAK,CAACjE,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;EACrCkE,IAAAA,KAAK,CAAClE,CAAD,CAAL,CAASsE,GAAT;EACD;;EACDJ,EAAAA,KAAK,GAAG,EAAR;EACAjD,EAAAA,GAAG,GAAG,EAAN;EACAkD,EAAAA,OAAO,GAAG,KAAV;EACD;;ECrBD,IAAI9B,IAAE,GAAG,CAAT;;MACMkC;EACJ;EACF;EACA;EACA;EACA;EACA;EACA;EACE,mBAAYC,EAAZ,EAAgBC,cAAhB,EAAgC/E,EAAhC,EAAkD;EAAA,QAAde,OAAc,uEAAJ,EAAI;;EAAA;;EAChD,SAAK+D,EAAL,GAAUA,EAAV;EACA,SAAKnC,EAAL,GAAUA,IAAE,EAAZ,CAFgD;;EAGhD,SAAKqC,IAAL,GAAY,CAAC,CAACjE,OAAO,CAACiE,IAAtB,CAHgD;;EAIhD,SAAKC,IAAL,GAAY,CAAC,CAAClE,OAAO,CAACkE,IAAtB,CAJgD;;EAKhD,SAAKC,KAAL,GAAa,CAAC,CAACnE,OAAO,CAACkE,IAAvB,CALgD;;EAMhD,SAAKjF,EAAL,GAAUA,EAAV;EACA,SAAKe,OAAL,GAAeA,OAAf;EACA,SAAKoE,IAAL,GAAY,EAAZ;EACA,SAAKC,MAAL,GAAc,IAAIC,GAAJ,EAAd;;EACA,QAAI,OAAON,cAAP,KAA0B,QAA9B,EAAwC;EACtC;EACA;EACA;EACA;EACA,WAAKA,cAAL,GAAsB,YAAY;EAChC;EAEA;EACA,YAAIxD,GAAG,GAAGuD,EAAV;EACA,YAAMQ,GAAG,GAAGP,cAAc,CAACQ,KAAf,CAAqB,GAArB,CAAZ;;EACA,aAAK,IAAIjF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGgF,GAAG,CAAC/E,MAAxB,EAAgCD,CAAC,EAAjC,EAAqC;EACnCiB,UAAAA,GAAG,GAAGA,GAAG,CAAC+D,GAAG,CAAChF,CAAD,CAAJ,CAAT;EACD;;EACD,eAAOiB,GAAP;EACD,OAVD;EAWD,KAhBD,MAgBO;EACL;EACA,WAAKwD,cAAL,GAAsBA,cAAtB;EACD;;EAED,SAAKtB,KAAL,GAAa,KAAKwB,IAAL,GAAYO,SAAZ,GAAwB,KAAKnB,GAAL,EAArC;EACD;;;;aACD,eAAO;EACLlB,MAAAA,UAAU,CAAC,IAAD,CAAV,CADK;;EAGL,UAAMM,KAAK,GAAG,KAAKsB,cAAL,EAAd;EACA3B,MAAAA,SAAS,GAJJ;;EAKL,aAAOK,KAAP;EACD;;;;aAED,iBAAShB,GAAT,EAAc;EACZ,UAAME,EAAE,GAAGF,GAAG,CAACE,EAAf;;EACA,UAAI,CAAC,KAAKyC,MAAL,CAAYK,GAAZ,CAAgB9C,EAAhB,CAAL,EAA0B;EACxB,aAAKyC,MAAL,CAAYM,GAAZ,CAAgB/C,EAAhB;EACA,aAAKwC,IAAL,CAAUlF,IAAV,CAAewC,GAAf,EAFwB;;EAIxBA,QAAAA,GAAG,CAACkD,OAAJ,CAAY,IAAZ;EACD;EACF;EAED;EACA;;;;aACA,kBAAU;EACR,UAAI,KAAKV,IAAT,EAAe;EACb,aAAKC,KAAL,GAAa,IAAb;EACD,OAFD,MAEO;EACLR,QAAAA,YAAY,CAAC,IAAD,CAAZ;EACD;EACF;;;aACD,eAAO;EACL;EACA,UAAMH,MAAM,GAAG,KAAKF,GAAL,EAAf;;EACA,UAAI,KAAKW,IAAT,EAAe;EACb,YAAMY,QAAQ,GAAG,KAAKnC,KAAtB,CADa;;EAGb,aAAKA,KAAL,GAAac,MAAb,CAHa;;EAKb,aAAKvE,EAAL,CAAQmC,IAAR,CAAa,KAAK2C,EAAlB,EAAsBP,MAAtB,EAA8BqB,QAA9B;EACD;EACF;;;;aAED,sBAAc;EACZ,WAAKV,KAAL,GAAa,KAAb,CADY;;EAGZ,WAAKzB,KAAL,GAAa,KAAKY,GAAL,EAAb;EACD;;;aACD,kBAAU;EACR;EACA,UAAI/D,CAAC,GAAG,KAAK6E,IAAL,CAAU5E,MAAlB;;EACA,aAAOD,CAAC,EAAR,EAAY;EACV,YAAMmC,GAAG,GAAG,KAAK0C,IAAL,CAAU7E,CAAV,CAAZ;EACAmC,QAAAA,GAAG,CAAC0B,MAAJ;EACD;EACF;;;;;;EC3FI,SAAS0B,UAAT,CAAqBC,GAArB,EAA0B;EAC/BA,EAAAA,GAAG,CAACjE,SAAJ,CAAckE,MAAd,GAAuB,UAAU7E,GAAV,EAAe8E,OAAf,EAAsC;EAAA,QAAdjF,OAAc,uEAAJ,EAAI;EAC3D,QAAM+D,EAAE,GAAG,IAAX;EACA/D,IAAAA,OAAO,CAACiE,IAAR,GAAe,IAAf,CAF2D;;EAG3D,QAAIH,OAAJ,CAAYC,EAAZ,EAAgB5D,GAAhB,EAAqB8E,OAArB,EAA8BjF,OAA9B;EACD,GAJD;EAKD;EACM,SAASkF,SAAT,CAAoBnB,EAApB,EAAwB;EAC7B,MAAIA,EAAE,CAACoB,QAAH,CAAY3C,IAAhB,EAAsB;EACpB4C,IAAAA,QAAQ,CAACrB,EAAD,CAAR;EACD;;EACD,MAAIA,EAAE,CAACoB,QAAH,CAAYE,KAAhB,EAAuB;EACrBC,IAAAA,SAAS,CAACvB,EAAD,CAAT;EACD;;EACD,MAAIA,EAAE,CAACoB,QAAH,CAAYI,QAAhB,EAA0B;EACxBC,IAAAA,YAAY,CAACzB,EAAD,CAAZ;EACD;EACF;;EACD,SAAS0B,KAAT,CAAgB1B,EAAhB,EAAoB2B,MAApB,EAA4BvF,GAA5B,EAAiC;EAC/BF,EAAAA,MAAM,CAACwC,cAAP,CAAsBsB,EAAtB,EAA0B5D,GAA1B,EAA+B;EAC7BmD,IAAAA,GAD6B,iBACtB;EACL,aAAOS,EAAE,CAAC2B,MAAD,CAAF,CAAWvF,GAAX,CAAP;EACD,KAH4B;EAI7BoD,IAAAA,GAJ6B,eAIxBC,MAJwB,EAIhB;EACXO,MAAAA,EAAE,CAAC2B,MAAD,CAAF,CAAWvF,GAAX,IAAkBqD,MAAlB;EACD;EAN4B,GAA/B;EAQD;;EACD,SAAS4B,QAAT,CAAmBrB,EAAnB,EAAuB;EACrB,MAAIvB,IAAI,GAAGuB,EAAE,CAACoB,QAAH,CAAY3C,IAAvB;EACAA,EAAAA,IAAI,GAAGuB,EAAE,CAAC4B,KAAH,GAAW/H,UAAU,CAAC4E,IAAD,CAAV,GAAmBA,IAAI,CAACpB,IAAL,CAAU2C,EAAV,CAAnB,GAAmCvB,IAArD,CAFqB;;EAIrB,OAAK,IAAIrC,GAAT,IAAgBqC,IAAhB,EAAsB;EACpBiD,IAAAA,KAAK,CAAC1B,EAAD,EAAK,OAAL,EAAc5D,GAAd,CAAL;EACD;;EACD4C,EAAAA,OAAO,CAACP,IAAD,CAAP;EACD;;EACD,SAAS8C,SAAT,CAAoBvB,EAApB,EAAwB;EACtB,MAAMsB,KAAK,GAAGtB,EAAE,CAACoB,QAAH,CAAYE,KAA1B;EACApF,EAAAA,MAAM,CAAC+C,IAAP,CAAYqC,KAAZ,EAAmBpE,OAAnB,CAA2B,UAAAd,GAAG,EAAI;EAChC,QAAM8E,OAAO,GAAGI,KAAK,CAAClF,GAAD,CAArB,CADgC;EAGhC;EACA;;EACA,QAAInC,KAAK,CAACD,OAAN,CAAckH,OAAd,CAAJ,EAA4B;EAC1B,WAAK,IAAI1F,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG0F,OAAO,CAACzF,MAA5B,EAAoCD,CAAC,EAArC,EAAyC;EACvC,YAAMqG,EAAE,GAAGX,OAAO,CAAC1F,CAAD,CAAlB,CADuC;;EAGvCsG,QAAAA,aAAa,CAAC9B,EAAD,EAAK5D,GAAL,EAAUyF,EAAV,CAAb;EACD;EACF,KAND,MAMO;EACLC,MAAAA,aAAa,CAAC9B,EAAD,EAAK5D,GAAL,EAAU8E,OAAV,CAAb;EACD;EACF,GAdD;EAeD;;EACD,SAASO,YAAT,CAAuBzB,EAAvB,EAA2B;EACzB,MAAMwB,QAAQ,GAAGxB,EAAE,CAACoB,QAAH,CAAYI,QAA7B;EACAxB,EAAAA,EAAE,CAAC+B,iBAAH,GAAuB,EAAvB;EACA7F,EAAAA,MAAM,CAAC+C,IAAP,CAAYuC,QAAZ,EAAsBtE,OAAtB,CAA8B,UAAAd,GAAG,EAAI;EACnC,QAAMuC,KAAK,GAAG6C,QAAQ,CAACpF,GAAD,CAAtB,CADmC;;EAGnC,QAAI4F,MAAM,GAAG,OAAOrD,KAAP,KAAiB,UAAjB,GAA8BA,KAA9B,GAAsCA,KAAK,CAACY,GAAzD,CAHmC;EAKnC;EACA;;EACAS,IAAAA,EAAE,CAAC+B,iBAAH,CAAqB3F,GAArB,IAA4B,IAAI2D,OAAJ,CAAYC,EAAZ,EAAgBgC,MAAM,CAACC,IAAP,CAAYjC,EAAZ,CAAhB,EAAiC,YAAM,EAAvC,EAA4C;EAAEG,MAAAA,IAAI,EAAE;EAAR,KAA5C,CAA5B;EACA+B,IAAAA,cAAc,CAAClC,EAAD,EAAK5D,GAAL,EAAUuC,KAAV,CAAd;EACD,GATD;EAUD;;EAED,SAASmD,aAAT,CAAwB9B,EAAxB,EAA4B5D,GAA5B,EAAiC8E,OAAjC,EAA0C;EACxClB,EAAAA,EAAE,CAACiB,MAAH,CAAU7E,GAAV,EAAe8E,OAAf;EACD;EACD;EACA;EACA;EACA;;;EACA,SAASiB,oBAAT,CAA+B/F,GAA/B,EAAoC;EAClC;EACA,SAAO,YAAY;EACjB;EACA;EACA,QAAM8B,OAAO,GAAG,KAAK6D,iBAAL,CAAuB3F,GAAvB,CAAhB,CAHiB;;EAKjB,QAAI8B,OAAO,CAACkC,KAAZ,EAAmB;EACjB;EACAlC,MAAAA,OAAO,CAACkE,UAAR;EACD,KARgB;;;EAUjB,QAAItE,GAAG,CAACE,MAAR,EAAgB;EACd;EACA;EACAE,MAAAA,OAAO,CAACmB,MAAR;EACD;;EACD,WAAOnB,OAAO,CAACS,KAAf;EACD,GAhBD;EAiBD;;EACD,SAASuD,cAAT,CAAyBlC,EAAzB,EAA6B5D,GAA7B,EAAkCuC,KAAlC,EAAyC;EACvC,MAAI0D,aAAa,GAAG,EAApB;;EACA,MAAI,OAAO1D,KAAP,KAAiB,UAArB,EAAiC;EAC/B;EACA0D,IAAAA,aAAa,CAAC9C,GAAd,GAAoB4C,oBAAoB,CAAC/F,GAAD,CAAxC;EACD,GAHD,MAGO;EACLiG,IAAAA,aAAa,CAAC9C,GAAd,GAAoB4C,oBAAoB,CAAC/F,GAAD,CAAxC;EACAiG,IAAAA,aAAa,CAAC7C,GAAd,GAAoBb,KAAK,CAACa,GAA1B;EACD,GARsC;;;EAUvCtD,EAAAA,MAAM,CAACwC,cAAP,CAAsBsB,EAAtB,EAA0B5D,GAA1B,EAA+BiG,aAA/B;EACD;;EChHM,SAASC,KAAT,CAAgBC,QAAhB,EAA0BC,KAA1B,EAAiC;EACtC,MAAI,CAACD,QAAL,EAAe;EACb,WAAOE,QAAQ,CAACD,KAAD,CAAf;EACD;;EACD,MAAMjG,MAAM,GAAGgG,QAAQ,CAACG,UAAxB;;EACA,MAAInG,MAAM,IAAIA,MAAM,CAACoG,QAAP,KAAoB,CAAlC,EAAqC;EACnC;EACA,QAAMC,GAAG,GAAGH,QAAQ,CAACD,KAAD,CAApB;EACAjG,IAAAA,MAAM,CAACsG,YAAP,CAAoBD,GAApB,EAAyBL,QAAQ,CAACO,WAAlC;EACAvG,IAAAA,MAAM,CAACwG,WAAP,CAAmBR,QAAnB;EACA,WAAOK,GAAP;EACD,GAND,MAMO;EACL;EACA;EACA;EACA,QAAIL,QAAQ,CAACpI,GAAT,KAAiBqI,KAAK,CAACrI,GAA3B,EAAgC;EAC9B,aAAOoI,QAAQ,CAACS,EAAT,CAAYN,UAAZ,CAAuBO,YAAvB,CAAoCR,QAAQ,CAACD,KAAD,CAA5C,EAAqDD,QAAQ,CAACS,EAA9D,CAAP;EACD,KANI;;;EAQL,QAAIA,EAAE,GAAGR,KAAK,CAACQ,EAAN,GAAWT,QAAQ,CAACS,EAA7B,CARK;;EAUL,QAAIT,QAAQ,CAACpI,GAAT,KAAiBuG,SAArB,EAAgC;EAC9B,UAAI6B,QAAQ,CAAC7H,IAAT,KAAkB8H,KAAK,CAAC9H,IAA5B,EAAkC;EAChCsI,QAAAA,EAAE,CAACE,WAAH,GAAiBV,KAAK,CAAC9H,IAAvB;EACD;;EACD;EACD,KAfI;;;EAiBLyI,IAAAA,UAAU,CAACX,KAAD,EAAQD,QAAQ,CAAC9D,IAAjB,CAAV,CAjBK;;EAmBL,QAAM2E,WAAW,GAAGb,QAAQ,CAACc,QAAT,IAAqB,EAAzC;EACA,QAAMC,WAAW,GAAGd,KAAK,CAACa,QAAN,IAAkB,EAAtC,CApBK;;EAsBL,QAAID,WAAW,CAAC3H,MAAZ,GAAqB,CAArB,IAA0B6H,WAAW,CAAC7H,MAAZ,GAAqB,CAAnD,EAAsD;EACpD;EACA8H,MAAAA,aAAa,CAACP,EAAD,EAAKI,WAAL,EAAkBE,WAAlB,CAAb;EACD,KAHD,MAGO,IAAIF,WAAW,CAAC3H,MAAZ,GAAqB,CAAzB,EAA4B;EACjC;EACAuH,MAAAA,EAAE,CAACQ,SAAH,GAAe,EAAf;EACD,KAHM,MAGA,IAAIF,WAAW,CAAC7H,MAAZ,GAAqB,CAAzB,EAA4B;EACjC;EACA,WAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG8H,WAAW,CAAC7H,MAAhC,EAAwCD,CAAC,EAAzC,EAA6C;EAC3CwH,QAAAA,EAAE,CAACS,WAAH,CAAehB,QAAQ,CAACa,WAAW,CAAC9H,CAAD,CAAZ,CAAvB;EACD;EACF;EACF;EACF;;EAED,SAAS+H,aAAT,CAAwBP,EAAxB,EAA4BI,WAA5B,EAAyCE,WAAzC,EAAsD;EACpD;EACA,MAAII,aAAa,GAAG,CAApB;EACA,MAAIC,YAAY,GAAGP,WAAW,CAACM,aAAD,CAA9B;EACA,MAAIE,WAAW,GAAGR,WAAW,CAAC3H,MAAZ,GAAqB,CAAvC;EACA,MAAIoI,UAAU,GAAGT,WAAW,CAACQ,WAAD,CAA5B;EAEA,MAAIE,aAAa,GAAG,CAApB;EACA,MAAIC,YAAY,GAAGT,WAAW,CAACQ,aAAD,CAA9B;EACA,MAAIE,WAAW,GAAGV,WAAW,CAAC7H,MAAZ,GAAqB,CAAvC;EACA,MAAIwI,UAAU,GAAGX,WAAW,CAACU,WAAD,CAA5B;;EACA,SAAQN,aAAa,IAAIE,WAAlB,IAAmCE,aAAa,IAAIE,WAA3D,EAAyE;EACvE;EACA,QAAIE,UAAU,CAACP,YAAD,EAAeI,YAAf,CAAd,EAA4C;EAC1C;EACA;EACAzB,MAAAA,KAAK,CAACqB,YAAD,EAAeI,YAAf,CAAL,CAH0C;;EAK1CJ,MAAAA,YAAY,GAAGP,WAAW,CAAC,EAAEM,aAAH,CAA1B;EACAK,MAAAA,YAAY,GAAGT,WAAW,CAAC,EAAEQ,aAAH,CAA1B;EACD,KAPD,MAOO,IAAII,UAAU,CAACL,UAAD,EAAaI,UAAb,CAAd,EAAwC;EAIhD,GAxBmD;;EA2BrD;;EAED,SAASC,UAAT,CAAqBC,OAArB,EAA8BC,OAA9B,EAAuC;EACrC,SAAQD,OAAO,CAAChK,GAAR,KAAgBiK,OAAO,CAACjK,GAAzB,IAAkCgK,OAAO,CAAC/H,GAAR,KAAgBgI,OAAO,CAAChI,GAAjE;EACD;;EAED,SAAS+G,UAAT,CAAqBX,KAArB,EAA2C;EAAA,MAAf6B,QAAe,uEAAJ,EAAI;EACzC,MAAIrB,EAAE,GAAGR,KAAK,CAACQ,EAAf;EACA,MAAIsB,QAAQ,GAAG9B,KAAK,CAAC/D,IAAN,IAAc,EAA7B;EACA,MAAI8F,QAAQ,GAAGD,QAAQ,CAACE,KAAT,IAAkB,EAAjC;EACA,MAAIC,QAAQ,GAAGJ,QAAQ,CAACG,KAAT,IAAkB,EAAjC;;EAEA,OAAK,IAAIpI,GAAT,IAAgBqI,QAAhB,EAA0B;EACxB;EACA,QAAI,CAACF,QAAQ,CAACnI,GAAD,CAAb,EAAoB;EAClB4G,MAAAA,EAAE,CAACwB,KAAH,CAASpI,GAAT,IAAgB,EAAhB;EACD;EACF;;EAED,OAAK,IAAIA,IAAT,IAAgBiI,QAAhB,EAA0B;EACxB;EACA,QAAI,CAACC,QAAQ,CAAClI,IAAD,CAAb,EAAoB;EAClB,UAAIA,IAAG,KAAK,OAAZ,EAAqB;EACnB,aAAK,IAAIsI,IAAT,IAAiBL,QAAQ,CAACjI,IAAD,CAAzB,EAAgC;EAC9B4G,UAAAA,EAAE,CAACwB,KAAH,CAASE,IAAT,IAAiB,EAAjB;EACD;EACF,OAJD,MAIO;EACL1B,QAAAA,EAAE,CAAC2B,eAAH,CAAmBvI,IAAnB;EACD;EACF;EACF,GAxBwC;;;EA2BzC,OAAK,IAAIA,KAAT,IAAgBkI,QAAhB,EAA0B;EACxB,QAAIlI,KAAG,KAAK,OAAZ,EAAqB;EACnB,WAAK,IAAIsI,KAAT,IAAiBJ,QAAQ,CAAClI,KAAD,CAAzB,EAAgC;EAC9B4G,QAAAA,EAAE,CAACwB,KAAH,CAASE,KAAT,IAAiBJ,QAAQ,CAAClI,KAAD,CAAR,CAAcsI,KAAd,CAAjB;EACD;EACF,KAJD,MAIO;EACL1B,MAAAA,EAAE,CAAC4B,YAAH,CAAgBxI,KAAhB,EAAqBkI,QAAQ,CAAClI,KAAD,CAA7B;EACD;EACF;EACF;;EAED,SAASyI,eAAT,CAA0BrC,KAA1B,EAAiC;EAC/B,MAAIhH,CAAC,GAAGgH,KAAK,CAAC/D,IAAd;;EACA,MAAI,CAACjD,CAAC,GAAGA,CAAC,CAACI,IAAP,MAAiBJ,CAAC,GAAGA,CAAC,CAACsJ,IAAvB,CAAJ,EAAkC;EAChC;EACAtJ,IAAAA,CAAC,CAACgH,KAAD,CAAD;EACD;;EACD,MAAIA,KAAK,CAACuC,iBAAV,EAA6B;EAAE;EAC7B,WAAO,IAAP;EACD;EACF;;EAEM,SAAStC,QAAT,CAAmBD,KAAnB,EAA0B;EAAA,EACgBA,KADhB,CACvBxC,EADuB;EAAA,UACnBtF,IADmB,GACgB8H,KADhB,CACnB9H,IADmB;EAAA,MACgB8H,KADhB,CACbpG,GADa;EAAA,UACRiH,QADQ,GACgBb,KADhB,CACRa,QADQ;EAAA,MACElJ,GADF,GACgBqI,KADhB,CACErI,GADF;EAAA,MACgBqI,KADhB,CACO/D;EACtC,MAAImE,GAAG,GAAG,EAAV;;EACA,MAAI,OAAOzI,GAAP,KAAe,QAAnB,EAA6B;EAC3B,QAAI0K,eAAe,CAACrC,KAAD,CAAnB,EAA4B;EAC1B;EACA,aAAOA,KAAK,CAACuC,iBAAN,CAAwBC,GAA/B;EACD,KAJ0B;;;EAM3BpC,IAAAA,GAAG,GAAGJ,KAAK,CAACQ,EAAN,GAAWiC,QAAQ,CAACC,aAAT,CAAuB/K,GAAvB,CAAjB,CAN2B;;EAO3BgJ,IAAAA,UAAU,CAACX,KAAD,CAAV;;EACA,QAAIa,QAAQ,IAAIA,QAAQ,CAAC5H,MAAzB,EAAiC;EAC/B,WAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG6H,QAAQ,CAAC5H,MAA7B,EAAqCD,CAAC,EAAtC,EAA0C;EACxC,YAAMuD,IAAI,GAAGsE,QAAQ,CAAC7H,CAAD,CAArB;EACAoH,QAAAA,GAAG,CAACa,WAAJ,CAAgBhB,QAAQ,CAAC1D,IAAD,CAAxB;EACD;EACF;EACF,GAdD,MAcO;EACL;EACA6D,IAAAA,GAAG,GAAGJ,KAAK,CAACQ,EAAN,GAAWiC,QAAQ,CAACE,cAAT,CAAwBzK,IAAxB,CAAjB;EACD;;EACD,SAAOkI,GAAP;EACD;;ECrJM,SAASwC,cAAT,CAAyBpF,EAAzB,EAA6BgD,EAA7B,EAAiC;EACtC;EACAqC,EAAAA,SAAS,CAACrF,EAAD,EAAK,aAAL,CAAT;;EACA,MAAMsF,eAAe,GAAG,SAAlBA,eAAkB,GAAM;EAC5B;EACA,QAAM9C,KAAK,GAAGxC,EAAE,CAACuF,OAAH,EAAd,CAF4B;;;EAI5BvF,IAAAA,EAAE,CAACwF,OAAH,CAAWhD,KAAX;EACD,GALD,CAHsC;EAUtC;;;EACA,MAAIzC,OAAJ,CAAYC,EAAZ,EAAgBsF,eAAhB,EAAiC,YAAM;EACrCG,IAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ;EACD,GAFD,EAEG,IAFH,EAXsC;;EActCL,EAAAA,SAAS,CAACrF,EAAD,EAAK,SAAL,CAAT;EACD;EACM,SAAS2F,cAAT,CAAyB3E,GAAzB,EAA8B;EACnCA,EAAAA,GAAG,CAACjE,SAAJ,CAAcyI,OAAd,GAAwB,UAAUhD,KAAV,EAAiB;EACvC,QAAMxC,EAAE,GAAG,IAAX;EACAA,IAAAA,EAAE,CAACgF,GAAH,GAAS1C,KAAK,CAACtC,EAAE,CAACgF,GAAJ,EAASxC,KAAT,CAAd;EACD,GAHD;;EAIAxB,EAAAA,GAAG,CAACjE,SAAJ,CAAc6I,SAAd,GAA0B3K,QAA1B;EACD;;EAGM,SAASoK,SAAT,CAAoBrF,EAApB,EAAwBpE,IAAxB,EAA8B;EACnC;EACA;EACA;EACA,MAAMiK,QAAQ,GAAG7F,EAAE,CAACoB,QAAH,CAAYxF,IAAZ,CAAjB,CAJmC;;EAMnC,MAAIiK,QAAJ,EAAc;EACZ,SAAK,IAAIrK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGqK,QAAQ,CAACpK,MAA7B,EAAqCD,CAAC,EAAtC,EAA0C;EACxC,UAAM0F,OAAO,GAAG2E,QAAQ,CAACrK,CAAD,CAAxB,CADwC;;EAGxC0F,MAAAA,OAAO,CAAC7D,IAAR,CAAa2C,EAAb;EACD;EACF;EACF;;ECxCM,SAAS8F,UAAT,CAAqBzL,IAArB,EAA2B;EAChC;EACF;EACA;EACA;EACA;EACA;EACA;EACE;EACA,MAAI0L,IAAI,GAAG,IAAX;;EACA,WAASC,OAAT,CAAkBC,GAAlB,EAAuB;EACrB5L,IAAAA,IAAI,GAAGA,IAAI,CAAC6L,SAAL,CAAeD,GAAf,CAAP;EACD,GAZ+B;;;EAchC,MAAM7H,KAAK,GAAG,EAAd,CAdgC;;EAgBhC,WAAS+H,gBAAT,CAA2BhM,GAA3B,EAAgCiM,KAAhC,EAAuC;EACrC,WAAO;EACLjM,MAAAA,GAAG,EAAHA,GADK;EAELoC,MAAAA,MAAM,EAAE,IAFH;EAGL8G,MAAAA,QAAQ,EAAE,EAHL;EAIL+C,MAAAA,KAAK,EAALA,KAJK;EAKLC,MAAAA,IAAI,EAAE,CALD;EAML3L,MAAAA,IAAI,EAAE;EAND,KAAP;EAQD;;EACD,WAAS4L,KAAT,CAAgBnM,GAAhB,EAAqBoM,UAArB,EAAiC;EAE/B;EACA;EACA,QAAMhK,MAAM,GAAG6B,KAAK,CAACA,KAAK,CAAC3C,MAAN,GAAe,CAAhB,CAApB,CAJ+B;;EAM/B,QAAM+K,OAAO,GAAGL,gBAAgB,CAAChM,GAAD,EAAMoM,UAAN,CAAhC,CAN+B;;EAQ/B,QAAI,CAACR,IAAL,EAAW;EACTA,MAAAA,IAAI,GAAGS,OAAP;EACD;;EACD,QAAIjK,MAAJ,EAAY;EACV;EACAA,MAAAA,MAAM,CAAC8G,QAAP,CAAgBlI,IAAhB,CAAqBqL,OAArB;EACAA,MAAAA,OAAO,CAACjK,MAAR,GAAiBA,MAAjB;EACD;;EACD6B,IAAAA,KAAK,CAACjD,IAAN,CAAWqL,OAAX;EACD;;EACD,WAASC,KAAT,CAAgB/L,IAAhB,EAAsB;EACpB;EACA,QAAM6B,MAAM,GAAG6B,KAAK,CAACA,KAAK,CAAC3C,MAAN,GAAe,CAAhB,CAApB;EACAf,IAAAA,IAAI,GAAGA,IAAI,CAACgM,OAAL,CAAa,KAAb,EAAoB,EAApB,CAAP;;EACA,QAAIhM,IAAJ,EAAU;EACR6B,MAAAA,MAAM,CAAC8G,QAAP,CAAgBlI,IAAhB,CAAqB;EACnBkL,QAAAA,IAAI,EAAE,CADa;EAEnB3L,QAAAA,IAAI,EAAJA;EAFmB,OAArB;EAID;EACF;;EACD,WAASiM,GAAT,CAAcxM,GAAd,EAAmB;EACjB;EACA,QAAMqM,OAAO,GAAGpI,KAAK,CAACG,GAAN,EAAhB;;EACA,QAAIiI,OAAO,CAACrM,GAAR,KAAgBA,GAApB,EAAyB;EACvB,YAAM,IAAIyM,KAAJ,CAAU,MAAV,CAAN;EACD;EACF,GA7D+B;;;EA+DhC,WAASC,aAAT,GAA0B;EACxB,QAAIzM,QAAQ,GAAGF,eAAe,CAACE,QAAhB,CAAyBC,IAAzB,CAAf;;EACA,QAAID,QAAJ,EAAc;EACZ4L,MAAAA,OAAO,CAAC5L,QAAQ,CAAC,CAAD,CAAR,CAAYqB,MAAb,CAAP;EACA,UAAIjB,KAAK,GAAG;EACVL,QAAAA,GAAG,EAAEC,QAAQ,CAAC,CAAD,CADH;EAEVgM,QAAAA,KAAK,EAAE;EAFG,OAAZ;;EAIA,UAAI1L,IAAJ,EAAUiM,IAAV,CANY;;;EAQZ,aAAO,EAAEA,IAAG,GAAGzM,eAAe,CAACS,QAAhB,CAAyBN,IAAzB,CAAR,MAA4CK,IAAI,GAAGR,eAAe,CAACO,aAAhB,CAA8BJ,IAA9B,CAAnD,CAAP,EAAgG;EAC9FG,QAAAA,KAAK,CAAC4L,KAAN,CAAYjL,IAAZ,CAAiB;EACfiB,UAAAA,GAAG,EAAE1B,IAAI,CAAC,CAAD,CADM;EAEfiE,UAAAA,KAAK,EAAEjE,IAAI,CAAC,CAAD,CAAJ,IAAWA,IAAI,CAAC,CAAD,CAAf,IAAsBA,IAAI,CAAC,CAAD;EAFlB,SAAjB;EAIAsL,QAAAA,OAAO,CAACtL,IAAI,CAAC,CAAD,CAAJ,CAAQe,MAAT,CAAP;EACD;;EACD,UAAIkL,IAAJ,EAAS;EACPX,QAAAA,OAAO,CAACW,IAAG,CAAC,CAAD,CAAH,CAAOlL,MAAR,CAAP;EACD;;EACD,aAAOjB,KAAP;EACD;;EACD,WAAO,KAAP;EACD,GAtF+B;;;EAwFhC,WAASsM,WAAT,GAAwB;EACtB,QAAIC,MAAM,GAAG7M,eAAe,CAACU,QAAhB,CAAyBP,IAAzB,CAAb;;EACA,QAAI0M,MAAJ,EAAY;EACVf,MAAAA,OAAO,CAACe,MAAM,CAAC,CAAD,CAAN,CAAUtL,MAAX,CAAP;EACA,aAAOsL,MAAM,CAAC,CAAD,CAAb;EACD;;EACD,WAAO,KAAP;EACD;;EACD,SAAO1M,IAAP,EAAa;EACX,QAAI2M,KAAK,GAAG3M,IAAI,CAAC4M,OAAL,CAAa,GAAb,CAAZ;;EACA,QAAID,KAAK,KAAK,CAAd,EAAiB;EACf;EACA;EACA,UAAIE,UAAU,GAAGL,aAAa,EAA9B;;EACA,UAAIK,UAAJ,EAAgB;EACdZ,QAAAA,KAAK,CAACY,UAAU,CAAC/M,GAAZ,EAAiB+M,UAAU,CAACd,KAA5B,CAAL;EACA;EACD;;EACD,UAAIe,QAAQ,GAAGL,WAAW,EAA1B;;EACA,UAAIK,QAAJ,EAAc;EACZR,QAAAA,GAAG,CAACQ,QAAD,CAAH;EACA;EACD;EACF,KAfU;;;EAiBX,QAAIzM,IAAI,GAAGL,IAAI,CAACoD,KAAL,CAAW,CAAX,EAAcuJ,KAAd,CAAX;;EACA,QAAItM,IAAJ,EAAU;EACR+L,MAAAA,KAAK,CAAC/L,IAAD,CAAL;EACAsL,MAAAA,OAAO,CAACtL,IAAI,CAACe,MAAN,CAAP;EACD;EACF;;EACD,SAAOsK,IAAP;EACD;;ECxHD,SAASqB,GAAT,CAAcC,CAAd,EAAiB;EACf,MAAIA,CAAC,CAAChB,IAAF,KAAW,CAAf,EAAkB;EAChB;EACA,WAAOiB,QAAQ,CAACD,CAAD,CAAf;EACD,GAHD,MAGO;EACL;EACA,QAAM3M,IAAI,GAAG2M,CAAC,CAAC3M,IAAf;EACA,QAAM6M,MAAM,GAAGrN,eAAe,CAACW,EAAhB,CAAmBH,IAAnB,CAAf,CAHK;;EAKL,QAAI,CAAC6M,MAAL,EAAa;EACX,2BAAc7M,IAAd;EACD,KAFD,MAEO;EACL,UAAMJ,GAAG,GAAGJ,eAAe,CAACW,EAAhB,CAAmBH,IAAnB,EAAyB,CAAzB,CAAZ;EACA,UAAI8M,MAAM,GAAG,EAAb;EACA,UAAIC,SAAS,GAAG,CAAhB;EACA/M,MAAAA,IAAI,CAACgM,OAAL,CAAapM,GAAb,EAAkB,YAAmB;EAAA,0CAAN8C,IAAM;EAANA,UAAAA,IAAM;EAAA;;EACnC,YAAI1C,IAAI,CAAC+C,KAAL,CAAWgK,SAAX,EAAsBrK,IAAI,CAAC,CAAD,CAA1B,CAAJ,EAAoC;EAClCoK,UAAAA,MAAM,CAACrM,IAAP,CAAYuM,IAAI,CAACC,SAAL,CAAejN,IAAI,CAAC+C,KAAL,CAAWgK,SAAX,EAAsBrK,IAAI,CAAC,CAAD,CAA1B,CAAf,CAAZ;EACD;;EACD,YAAIqK,SAAS,GAAG/M,IAAI,CAACe,MAAL,GAAc,CAA9B,EAAiC;EAC/B+L,UAAAA,MAAM,CAACrM,IAAP,CAAYiC,IAAI,CAAC,CAAD,CAAJ,CAAQwK,IAAR,EAAZ;EACD;;EACDH,QAAAA,SAAS,GAAGrK,IAAI,CAAC,CAAD,CAAJ,GAAWA,IAAI,CAAC,CAAD,CAAJ,CAAQ3B,MAA/B;EACD,OARD;;EASA,UAAIgM,SAAS,GAAG/M,IAAI,CAACe,MAArB,EAA6B;EAC3B,YAAIf,IAAI,CAAC+C,KAAL,CAAWgK,SAAX,CAAJ,EAA2B;EACzBD,UAAAA,MAAM,CAACrM,IAAP,CAAYuM,IAAI,CAACC,SAAL,CAAejN,IAAI,CAAC+C,KAAL,CAAWgK,SAAX,CAAf,CAAZ;EACD;EACF;;EACD,0BAAaD,MAAM,CAACK,IAAP,CAAY,GAAZ,CAAb;EACD;EACF;EACF;;EACD,SAASC,WAAT,CAAsB/B,IAAtB,EAA4B;EAC1B,MAAM1C,QAAQ,GAAG0C,IAAI,CAAC1C,QAAtB;;EACA,MAAIA,QAAQ,IAAIA,QAAQ,CAAC5H,MAAzB,EAAiC;EAC/B,QAAMsM,GAAG,GAAG1E,QAAQ,CAAC2E,GAAT,CAAa,UAAAX,CAAC;EAAA,aAAID,GAAG,CAACC,CAAD,CAAP;EAAA,KAAd,EAA0BQ,IAA1B,CAA+B,GAA/B,CAAZ;EACA,WAAOE,GAAP;EACD;;EACD,SAAO,KAAP;EACD;;EACD,SAASE,QAAT,CAAmBC,KAAnB,EAA0B;EACxB,MAAItL,GAAG,GAAG,EAAV;;EACA,OAAK,IAAIpB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG0M,KAAK,CAACzM,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;EAAA,mBAChB0M,KAAK,CAAC1M,CAAD,CADW;EAAA,QAC/BY,GAD+B,YAC/BA,GAD+B;EAAA,QAC1BuC,KAD0B,YAC1BA,KAD0B;;EAErC,QAAIvC,GAAG,KAAK,OAAZ,EAAqB;EAAA;EACnB,YAAI+L,QAAQ,GAAG,EAAf,CADmB;;EAGnBxJ,QAAAA,KAAK,CAAC+H,OAAN,CAAc,oBAAd,EAAoC,UAAU0B,CAAV,EAAaC,EAAb,EAAiBC,EAAjB,EAAqB;EACvDH,UAAAA,QAAQ,CAACE,EAAD,CAAR,GAAeC,EAAf;EACD,SAFD;EAGA3J,QAAAA,KAAK,GAAGwJ,QAAR;EANmB;EAOpB;;EACDvL,IAAAA,GAAG,cAAOR,GAAP,cAAcsL,IAAI,CAACC,SAAL,CAAehJ,KAAf,CAAd,MAAH;EACD;;EACD,oBAAW/B,GAAG,CAACa,KAAJ,CAAU,CAAV,EAAa,CAAC,CAAd,CAAX;EACD;;EACM,SAAS6J,QAAT,CAAmBvB,IAAnB,EAAyB;EAC9B;;EACA;EACF;EACA;EACA;EACE,MAAM1C,QAAQ,GAAGyE,WAAW,CAAC/B,IAAD,CAA5B;EACA,MAAIwC,IAAI,iBAAUxC,IAAI,CAAC5L,GAAf,eAAuB4L,IAAI,CAACK,KAAL,CAAW3K,MAAX,GAAoBwM,QAAQ,CAAClC,IAAI,CAACK,KAAN,CAA5B,GAA2C,WAAlE,SAAgF/C,QAAQ,cAAOA,QAAP,IAAoB,EAA5G,MAAR,CAP8B;;EAS9B,SAAOkF,IAAP;EACD;;EClEM,SAASC,iBAAT,CAA4BnO,IAA5B,EAAkC;EACvC;EACA,MAAI0L,IAAI,GAAGD,UAAU,CAACzL,IAAD,CAArB,CAFuC;;EAIvC,MAAIkO,IAAI,GAAGjB,QAAQ,CAACvB,IAAD,CAAnB,CAJuC;EAMvC;;EACA,MAAI0C,MAAM,GAAG,IAAIC,QAAJ,6BAAkCH,IAAlC,OAAb,CAPuC;;EASvC;EACF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EACE,SAAOE,MAAP;EACD;;ECnCM,SAASE,SAAT,CAAoB3H,GAApB,EAAyB;EAC9BA,EAAAA,GAAG,CAACjE,SAAJ,CAAc6L,KAAd,GAAsB,UAAU3M,OAAV,EAAmB;EACvC,QAAM+D,EAAE,GAAG,IAAX,CADuC;EAGvC;;EACAA,IAAAA,EAAE,CAACoB,QAAH,GAAc9E,YAAY,CAAC0D,EAAE,CAAC6I,WAAH,CAAe5M,OAAhB,EAAyBA,OAAzB,CAA1B,CAJuC;;EAMvCoJ,IAAAA,SAAS,CAACrF,EAAD,EAAK,cAAL,CAAT;EACAmB,IAAAA,SAAS,CAACnB,EAAD,CAAT,CAPuC;;EASvCqF,IAAAA,SAAS,CAACrF,EAAD,EAAK,SAAL,CAAT,CATuC;;EAWvC,QAAIA,EAAE,CAACoB,QAAH,CAAY4B,EAAhB,EAAoB;EAClBhD,MAAAA,EAAE,CAAC8I,MAAH,CAAU9I,EAAE,CAACoB,QAAH,CAAY4B,EAAtB;EACD;EACF,GAdD;;EAeAhC,EAAAA,GAAG,CAACjE,SAAJ,CAAc+L,MAAd,GAAuB,UAAU9F,EAAV,EAAc;EACnC,QAAMhD,EAAE,GAAG,IAAX;EACA,QAAM/D,OAAO,GAAG+D,EAAE,CAACoB,QAAnB;EACA4B,IAAAA,EAAE,GAAGiC,QAAQ,CAAC8D,aAAT,CAAuB/F,EAAvB,CAAL;EACAhD,IAAAA,EAAE,CAACgF,GAAH,GAAShC,EAAT,CAJmC;;EAMnC,QAAI,CAAC/G,OAAO,CAACwM,MAAb,EAAqB;EAAE;EACrB,UAAIO,QAAQ,GAAG/M,OAAO,CAAC+M,QAAvB;;EACA,UAAI,CAACA,QAAD,IAAahG,EAAjB,EAAqB;EAAE;EACrBgG,QAAAA,QAAQ,GAAGhG,EAAE,CAACiG,SAAd;EACD;;EACD,UAAIR,MAAM,GAAGD,iBAAiB,CAACQ,QAAD,CAA9B;EACA/M,MAAAA,OAAO,CAACwM,MAAR,GAAiBA,MAAjB;EACD,KAbkC;;;EAenCrD,IAAAA,cAAc,CAACpF,EAAD,CAAd;EACD,GAhBD;EAiBD;;ECrCM,SAASkF,aAAT,CAAwBlF,EAAxB,EAA4B7F,GAA5B,EAAyD;EAAA,MAAxBsE,IAAwB,uEAAjB,EAAiB;;EAAA,oCAAV4E,QAAU;EAAVA,IAAAA,QAAU;EAAA;;EAC9D;EACA;EACA,MAAI1G,YAAY,CAACxC,GAAD,CAAhB,EAAuB;EACrB,WAAO+O,UAAU,CAAClJ,EAAD,EAAK7F,GAAL,EAAUsE,IAAV,EAAgBA,IAAI,CAACrC,GAArB,EAA0BiH,QAA1B,EAAoC3C,SAApC,CAAjB;EACD,GAFD,MAEO;EACL;EACA,QAAMyI,IAAI,GAAGnJ,EAAE,CAACoB,QAAH,CAAYtF,UAAZ,CAAuB3B,GAAvB,CAAb;EACA,WAAO0K,iBAAe,CAAC7E,EAAD,EAAK7F,GAAL,EAAUsE,IAAV,EAAgBA,IAAI,CAACrC,GAArB,EAA0BiH,QAA1B,EAAoC8F,IAApC,CAAtB;EACD;EACF;;EAED,SAAStE,iBAAT,CAA0B7E,EAA1B,EAA8B7F,GAA9B,EAAmCsE,IAAnC,EAAyCrC,GAAzC,EAA8CiH,QAA9C,EAAwD8F,IAAxD,EAA8D;EAC5D,MAAIpP,QAAQ,CAACoP,IAAD,CAAZ,EAAoB;EAClB;EACAA,IAAAA,IAAI,GAAGnJ,EAAE,CAACoB,QAAH,CAAYgI,KAAZ,CAAkBC,MAAlB,CAAyBF,IAAzB,CAAP;EACD;;EACD1K,EAAAA,IAAI,CAAC7C,IAAL,GAAY;EACVkJ,IAAAA,IADU,gBACJtC,KADI,EACG;EACX;EACA,UAAI2G,IAAJ,EAAU;EACR,YAAInJ,GAAE,GAAGwC,KAAK,CAACuC,iBAAN,GAA0B,IAAIoE,IAAJ,CAAS;EAAEG,UAAAA,WAAW,EAAE;EAAf,SAAT,CAAnC;;EACAtJ,QAAAA,GAAE,CAAC8I,MAAH;EACD;EACF;EAPS,GAAZ,CAL4D;EAe5D;;EACA,SAAOI,UAAU,CAAClJ,EAAD,0BAAsB7F,GAAtB,GAA6BsE,IAA7B,EAAmCrC,GAAnC,EAAwCsE,SAAxC,EAAmDA,SAAnD,EAA8D;EAAEyI,IAAAA,IAAI,EAAJA,IAAF;EAAQ9F,IAAAA,QAAQ,EAARA;EAAR,GAA9D,CAAjB;EACD;;EAEM,SAASkG,UAAT,CAAqBvJ,EAArB,EAAyBtF,IAAzB,EAA+B;EACpC,SAAOwO,UAAU,CAAClJ,EAAD,EAAKU,SAAL,EAAgBA,SAAhB,EAA2BA,SAA3B,EAAsCA,SAAtC,EAAiDhG,IAAjD,CAAjB;EACD;;EACD,SAASwO,UAAT,CAAqBlJ,EAArB,EAAyB7F,GAAzB,EAA8BsE,IAA9B,EAAoCrC,GAApC,EAAyCiH,QAAzC,EAAmD3I,IAAnD,EAAyD8O,gBAAzD,EAA2E;EACzE,SAAO;EACLxJ,IAAAA,EAAE,EAAFA,EADK;EAEL7F,IAAAA,GAAG,EAAHA,GAFK;EAGLsE,IAAAA,IAAI,EAAJA,IAHK;EAILrC,IAAAA,GAAG,EAAHA,GAJK;EAKLiH,IAAAA,QAAQ,EAARA,QALK;EAML3I,IAAAA,IAAI,EAAJA,IANK;EAOL8O,IAAAA,gBAAgB,EAAhBA;EAPK,GAAP;EASD;;EC3CM,SAASC,WAAT,CAAsBzI,GAAtB,EAA2B;EAChC;EACAA,EAAAA,GAAG,CAACjE,SAAJ,CAAc2M,EAAd,GAAmB,YAAmB;EAAA,sCAANtM,IAAM;EAANA,MAAAA,IAAM;EAAA;;EACpC,WAAO8H,aAAa,MAAb,UAAc,IAAd,SAAuB9H,IAAvB,EAAP;EACD,GAFD,CAFgC;;;EAMhC4D,EAAAA,GAAG,CAACjE,SAAJ,CAAc4M,EAAd,GAAmB,UAAUjP,IAAV,EAAgB;EACjC,WAAO6O,UAAU,CAAC,IAAD,EAAO7O,IAAP,CAAjB;EACD,GAFD;;EAGAsG,EAAAA,GAAG,CAACjE,SAAJ,CAAcwI,OAAd,GAAwB,YAAY;EAClC,QAAMvF,EAAE,GAAG,IAAX;EACA,QAAMyI,MAAM,GAAGzI,EAAE,CAACoB,QAAH,CAAYqH,MAA3B;EACA,QAAIjG,KAAK,GAAGiG,MAAM,CAACpL,IAAP,CAAY2C,EAAZ,CAAZ;EACA,WAAOwC,KAAP;EACD,GALD;EAMD;;ECjBD;EACA;EACA;EAEO,SAASoH,WAAT,CAAsB5I,GAAtB,EAA2B;EAChCA,EAAAA,GAAG,CAAC/E,OAAJ,GAAc,EAAd;;EACA+E,EAAAA,GAAG,CAAC6I,KAAJ,GAAY,UAAU5N,OAAV,EAAmB;EAC7B;EACA,SAAKA,OAAL,GAAeK,YAAY,CAAC,KAAKL,OAAN,EAAeA,OAAf,CAA3B;EACD,GAHD,CAFgC;;;EAOhC+E,EAAAA,GAAG,CAAC/E,OAAJ,CAAYmN,KAAZ,GAAoBpI,GAApB,CAPgC;;EAShCA,EAAAA,GAAG,CAAC/E,OAAJ,CAAYH,UAAZ,GAAyB,EAAzB;;EACAkF,EAAAA,GAAG,CAAC8I,SAAJ,GAAgB,UAAUjM,EAAV,EAAc5B,OAAd,EAAuB;EACrCA,IAAAA,OAAO,GAAG,KAAKA,OAAL,CAAamN,KAAb,CAAmBC,MAAnB,CAA0BpN,OAA1B,CAAV;EACA,SAAKA,OAAL,CAAaH,UAAb,CAAwB+B,EAAxB,IAA8B5B,OAA9B;EACD,GAHD;;EAIA+E,EAAAA,GAAG,CAACqI,MAAJ,GAAa,UAAUpN,OAAV,EAAmB;EAC9B,QAAM8N,KAAK,GAAG,IAAd;;EACA,QAAIC,GAAG,GAAG,SAASC,YAAT,CAAuBhO,OAAvB,EAAgC;EACxC,WAAK2M,KAAL,CAAW3M,OAAX;EACD,KAFD,CAF8B;EAM9B;;;EACA+N,IAAAA,GAAG,CAACjN,SAAJ,GAAgBb,MAAM,CAACC,MAAP,CAAc4N,KAAK,CAAChN,SAApB,CAAhB,CAP8B;;EAS9BiN,IAAAA,GAAG,CAACjN,SAAJ,CAAc8L,WAAd,GAA4BmB,GAA5B,CAT8B;;EAW9BA,IAAAA,GAAG,CAAC/N,OAAJ,GAAcK,YAAY,CAACyN,KAAK,CAAC9N,OAAP,EAAgBA,OAAhB,CAA1B;EACA,WAAO+N,GAAP;EACD,GAbD;EAcD;;EC3BD,SAAShJ,GAAT,CAAc/E,OAAd,EAAuB;EACrB,OAAK2M,KAAL,CAAW3M,OAAX;EACD;;EACD0M,SAAS,CAAC3H,GAAD,CAAT;EACAyI,WAAW,CAACzI,GAAD,CAAX;EACA2E,cAAc,CAAC3E,GAAD,CAAd;EACAD,UAAU,CAACC,GAAD,CAAV;EACA4I,WAAW,CAAC5I,GAAD,CAAX;EAOA;EAEA;EACA;EAEA;EACA;EAEA;EACA;EAEA;EACA;EAEA;;EACA,IAAIkJ,WAAW,sDAAf;EAKA,IAAIC,OAAO,GAAG3B,iBAAiB,CAAC0B,WAAD,CAA/B;EAEA,IAAIE,GAAG,GAAG,IAAIpJ,GAAJ,CAAQ;EAChBvC,EAAAA,IAAI,EAAE;EACJ4L,IAAAA,OAAO,EAAE;EADL;EADU,CAAR,CAAV;EAKA,IAAMlG,OAAO,GAAGgG,OAAO,CAAC9M,IAAR,CAAa+M,GAAb,CAAhB;EACAnF,QAAQ,CAACqF,IAAT,CAAc7G,WAAd,CAA0BhB,QAAQ,CAAC0B,OAAD,CAAlC;EAIA;EAEA;EACA;EAEA;EACA;EAEA;EACA;EAEA;EACA;EAEA;;EACA,IAAIoG,WAAW,sDAAf;EAMA,IAAIC,OAAO,GAAGhC,iBAAiB,CAAC+B,WAAD,CAA/B;EAEA,IAAIE,GAAG,GAAG,IAAIzJ,GAAJ,CAAQ;EAChBvC,EAAAA,IAAI,EAAE;EACJ4L,IAAAA,OAAO,EAAE;EADL;EADU,CAAR,CAAV;EAKA,IAAMjG,OAAO,GAAGoG,OAAO,CAACnN,IAAR,CAAaoN,GAAb,CAAhB;EAEAC,UAAU,CAAC,YAAM;EACfpI,EAAAA,KAAK,CAAC6B,OAAD,EAAUC,OAAV,CAAL;EACD,CAFS,EAEP,IAFO,CAAV;;;;;;;;"}